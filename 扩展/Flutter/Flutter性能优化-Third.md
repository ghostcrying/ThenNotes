# Flutteræ€§èƒ½ä¼˜åŒ–

### ç›®å½•

- ä¸€ã€æ£€æµ‹æ‰‹æ®µ
  - 1ã€Flutter Inspector
  - 2ã€æ€§èƒ½å›¾å±‚
  - 3ã€Raster çº¿ç¨‹é—®é¢˜
  - 4ã€UI çº¿ç¨‹é—®é¢˜å®šä½
  - 5ã€æ£€æŸ¥å¤šè§†å›¾å åŠ çš„è§†å›¾æ¸²æŸ“å¼€å…³ checkerboardOffscreenLayers
  - 6ã€æ£€æŸ¥ç¼“å­˜çš„å›¾åƒå¼€å…³ checkerboardRasterCacheImages
- äºŒã€å…³é”®ä¼˜åŒ–æŒ‡æ ‡
  - 1ã€é¡µé¢å¼‚å¸¸ç‡
  - 2ã€é¡µé¢å¸§ç‡
  - 3ã€é¡µé¢åŠ è½½æ—¶é•¿
- ä¸‰ã€å¸ƒå±€åŠ è½½ä¼˜åŒ–
  - 1ã€å¸¸è§„ä¼˜åŒ–
  - 2ã€æ·±å…¥ä¼˜åŒ–
- å››ã€å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–
  - 1ã€å¼•æ“é¢„åŠ è½½
  - 2ã€Dart VM é¢„çƒ­
- äº”ã€å†…å­˜ä¼˜åŒ–
  - 1ã€const å®ä¾‹åŒ–
  - 2ã€è¯†åˆ«å‡ºæ¶ˆè€—å¤šä½™å†…å­˜çš„å›¾ç‰‡
  - 3ã€é’ˆå¯¹ ListView item ä¸­æœ‰ image çš„æƒ…å†µæ¥ä¼˜åŒ–å†…å­˜
- å…­ã€åŒ…ä½“ç§¯ä¼˜åŒ–
  - 1ã€å›¾ç‰‡ä¼˜åŒ–
  - 2ã€ç§»é™¤å†—ä½™çš„äºŒä¸‰åº“
  - 3ã€å¯ç”¨ä»£ç ç¼©å‡å’Œèµ„æºç¼©å‡
  - 4ã€æ„å»ºå• ABI æ¶æ„çš„åŒ…
- ä¸ƒã€æ€»ç»“



# å‰è¨€

Flutter ä½œä¸ºç›®å‰æœ€ç«çˆ†çš„ç§»åŠ¨ç«¯è·¨å¹³å°æ¡†æ¶ï¼Œèƒ½å¤Ÿå¸®åŠ©å¼€å‘è€…é€šè¿‡ä¸€å¥—ä»£ç åº“é«˜æ•ˆåœ°æ„å»ºå¤šå¹³å°çš„ç²¾ç¾åº”ç”¨ï¼Œå¹¶æ”¯æŒç§»åŠ¨ã€Webã€æ¡Œé¢å’ŒåµŒå…¥å¼å¹³å°ã€‚å¯¹äº Android æ¥è¯´ï¼ŒFlutter èƒ½å¤Ÿåˆ›ä½œåª²ç¾åŸç”Ÿçš„é«˜æ€§èƒ½åº”ç”¨ï¼Œä½†æ˜¯ï¼Œåœ¨è¾ƒä¸ºå¤æ‚çš„ App ä¸­ï¼Œä½¿ç”¨ Flutter å¼€å‘ä¹Ÿå¾ˆéš¾é¿å…äº§ç”Ÿå„ç§å„æ ·çš„æ€§èƒ½é—®é¢˜ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å°†å’Œä½ ä¸€èµ·å…¨æ–¹ä½åœ°æ·±å…¥æ¢ç´¢ Flutter æ€§èƒ½ä¼˜åŒ–çš„ç–†åŸŸã€‚



# ä¸€ã€æ£€æµ‹æ‰‹æ®µ

### å‡†å¤‡

ä»¥ profile æ¨¡å¼å¯åŠ¨åº”ç”¨ï¼Œå¦‚æœæ˜¯æ··åˆ Flutter åº”ç”¨ï¼Œåœ¨ flutter/packages/flutter_tools/gradle/flutter.gradle çš„ buildModeFor æ–¹æ³•ä¸­å°† debug æ¨¡å¼æ”¹ä¸º profileå³å¯ã€‚

### ä¸ºä»€ä¹ˆè¦åœ¨åˆ†ææ¨¡å¼ä¸‹æ¥è°ƒè¯•åº”ç”¨æ€§èƒ½ï¼Ÿ

åˆ†ææ¨¡å¼åœ¨å‘å¸ƒæ¨¡å¼çš„åŸºç¡€ä¹‹ä¸Šï¼Œä¸ºåˆ†æå·¥å…·æä¾›äº†å°‘é‡å¿…è¦çš„åº”ç”¨è¿½è¸ªä¿¡æ¯ã€‚

### é‚£ï¼Œä¸ºä»€ä¹ˆè¦åœ¨å‘å¸ƒæ¨¡å¼çš„åŸºç¡€ä¸Šæ¥è°ƒè¯•åº”ç”¨æ€§èƒ½ï¼Ÿ

ä¸è°ƒè¯•ä»£ç å¯ä»¥åœ¨è°ƒè¯•æ¨¡å¼ä¸‹æ£€æµ‹ Bug ä¸åŒï¼Œæ€§èƒ½é—®é¢˜éœ€è¦åœ¨å‘å¸ƒæ¨¡å¼ä¸‹ä½¿ç”¨çœŸæœºè¿›è¡Œæ£€æµ‹ã€‚è¿™æ˜¯å› ä¸ºï¼Œç›¸æ¯”å‘å¸ƒæ¨¡å¼è€Œè¨€ï¼Œ**è°ƒè¯•æ¨¡å¼å¢åŠ äº†å¾ˆå¤šé¢å¤–çš„æ£€æŸ¥ï¼ˆæ¯”å¦‚æ–­è¨€ï¼‰ï¼Œè¿™äº›æ£€æŸ¥å¯èƒ½ä¼šè€—è´¹å¾ˆå¤šèµ„æºï¼Œè€Œæ›´é‡è¦çš„æ˜¯ï¼Œè°ƒè¯•æ¨¡å¼ä½¿ç”¨ JIT æ¨¡å¼è¿è¡Œåº”ç”¨ï¼Œä»£ç æ‰§è¡Œæ•ˆç‡è¾ƒä½ã€‚è¿™å°±ä½¿å¾—è°ƒè¯•æ¨¡å¼è¿è¡Œçš„åº”ç”¨ï¼Œæ— æ³•çœŸå®åæ˜ å‡ºå®ƒçš„æ€§èƒ½é—®é¢˜**ã€‚

è€Œå¦ä¸€æ–¹é¢ï¼Œ**æ¨¡æ‹Ÿå™¨ä½¿ç”¨çš„æŒ‡ä»¤é›†ä¸º x86ï¼Œè€ŒçœŸæœºä½¿ç”¨çš„æŒ‡ä»¤é›†æ˜¯ ARM**ã€‚è¿™ä¸¤ç§æ–¹å¼çš„äºŒè¿›åˆ¶ä»£ç æ‰§è¡Œè¡Œä¸ºå®Œå…¨ä¸åŒï¼Œå› æ­¤ï¼Œæ¨¡æ‹Ÿå™¨ä¸çœŸæœºçš„æ€§èƒ½å·®å¼‚è¾ƒå¤§ï¼Œä¾‹å¦‚ï¼Œé’ˆå¯¹ä¸€äº› x86 æŒ‡ä»¤é›†æ“…é•¿çš„æ“ä½œï¼Œæ¨¡æ‹Ÿå™¨ä¼šæ¯”çœŸæœºå¿«ï¼Œè€Œå¦ä¸€äº›æ“ä½œåˆ™ä¼šæ¯”çœŸæœºæ…¢ã€‚è¿™ä¹ŸåŒæ—¶æ„å‘³ç€ï¼Œä½ æ— æ³•ä½¿ç”¨æ¨¡æ‹Ÿå™¨æ¥è¯„ä¼°çœŸæœºæ‰èƒ½å‡ºç°çš„æ€§èƒ½é—®é¢˜ã€‚

## 1ã€Flutter Inspector

Flutter Inspectoræœ‰å¾ˆå¤šåŠŸèƒ½ï¼Œä½†ä½ åº”è¯¥æŠŠæ³¨æ„åŠ›èŠ±åœ¨æ›´æœ‰ç”¨çš„åŠŸèƒ½å­¦ä¹ ä¸Šï¼Œä¾‹å¦‚ï¼š**â€œSelect Widget Modeâ€ å’Œ â€œRepaint Rainbowâ€**ã€‚

### Select Widget Mode

ç‚¹å‡» â€œSelect Widget Modeâ€ å›¾æ ‡ï¼Œå¯ä»¥åœ¨æ‰‹æœºä¸ŠæŸ¥çœ‹å½“å‰é¡µé¢çš„å¸ƒå±€æ¡†æ¶ä¸å®¹å™¨ç±»å‹ã€‚

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/8d3d4ce3dd9a4427aa4088a6618f10a9~tplv-k3u1fbpfcp-watermark.image)

#### ä½œç”¨

**å¿«é€ŸæŸ¥çœ‹é™Œç”Ÿé¡µé¢çš„å¸ƒå±€å®ç°æ–¹å¼**ã€‚

### Repaint Rainbow

ç‚¹å‡» â€œRepaint Rainbowâ€ å›¾æ ‡ï¼Œå®ƒä¼š **ä¸ºæ‰€æœ‰ RenderBox ç»˜åˆ¶ä¸€å±‚å¤–æ¡†ï¼Œå¹¶åœ¨å®ƒä»¬é‡ç»˜æ—¶ä¼šæ”¹å˜é¢œè‰²**ã€‚

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/73eaaf50a2a341ee878cacbcdfa56360~tplv-k3u1fbpfcp-watermark.image)

#### ä½œç”¨

**å¸®ä½ æ‰¾åˆ° App ä¸­é¢‘ç¹é‡ç»˜å¯¼è‡´æ€§èƒ½æ¶ˆè€—è¿‡å¤§çš„éƒ¨åˆ†**ã€‚

ä¾‹å¦‚ï¼šä¸€ä¸ªå°åŠ¨ç”»å¯èƒ½ä¼šå¯¼è‡´æ•´ä¸ªé¡µé¢é‡ç»˜ï¼Œè¿™ä¸ªæ—¶å€™ä½¿ç”¨ RepaintBoundary Widget åŒ…è£¹å®ƒï¼Œå¯ä»¥å°†é‡ç»˜èŒƒå›´ç¼©å°è‡³æœ¬èº«æ‰€å ç”¨çš„åŒºåŸŸï¼Œè¿™æ ·å°±å¯ä»¥å‡å°‘ç»˜åˆ¶æ¶ˆè€—ã€‚

#### ä½¿ç”¨åœºæ™¯

ä¾‹å¦‚ **é¡µé¢çš„è¿›åº¦æ¡åŠ¨ç”»åˆ·æ–°æ—¶ä¼šå¯¼è‡´æ•´ä¸ªå¸ƒå±€é¢‘ç¹é‡ç»˜**ã€‚

#### ç¼ºç‚¹

**ä½¿ç”¨ RepaintBoundary Widget ä¼šåˆ›å»ºé¢å¤–çš„ç»˜åˆ¶ç”»å¸ƒï¼Œè¿™å°†ä¼šå¢åŠ ä¸€å®šçš„å†…å­˜æ¶ˆè€—**ã€‚

## 2ã€æ€§èƒ½å›¾å±‚

æ€§èƒ½å›¾å±‚ä¼šåœ¨å½“å‰åº”ç”¨çš„æœ€ä¸Šå±‚ï¼Œä»¥ Flutter å¼•æ“è‡ªç»˜çš„æ–¹å¼å±•ç¤º Raster ä¸ UI çº¿ç¨‹çš„æ‰§è¡Œå›¾è¡¨ï¼Œè€Œå…¶ä¸­æ¯ä¸€å¼ å›¾è¡¨éƒ½ä»£è¡¨å½“å‰çº¿ç¨‹æœ€è¿‘ 300 å¸§çš„è¡¨ç°ï¼Œå¦‚æœ UI äº§ç”Ÿäº†å¡é¡¿ï¼ˆè·³å¸§ï¼‰ï¼Œè¿™äº›å›¾è¡¨å¯ä»¥å¸®åŠ©ä½ åˆ†æå¹¶æ‰¾åˆ°åŸå› ã€‚

**è“è‰²å‚ç›´çš„çº¿æ¡è¡¨ç¤ºå·²æ‰§è¡Œçš„æ­£å¸¸å¸§ï¼Œç»¿è‰²çš„çº¿æ¡ä»£è¡¨çš„æ˜¯å½“å‰å¸§ï¼Œå¦‚æœå…¶ä¸­æœ‰ä¸€å¸§å¤„ç†æ—¶é—´è¿‡é•¿ï¼Œå°±ä¼šå¯¼è‡´ç•Œé¢å¡é¡¿ï¼Œå›¾è¡¨ä¸­å°±ä¼šå±•ç¤ºå‡ºä¸€ä¸ªçº¢è‰²ç«–æ¡**ã€‚

**å¦‚æœçº¢è‰²ç«–æ¡å‡ºç°åœ¨ GPU çº¿ç¨‹å›¾è¡¨ï¼Œæ„å‘³ç€æ¸²æŸ“çš„å›¾å½¢å¤ªå¤æ‚ï¼Œå¯¼è‡´æ— æ³•å¿«é€Ÿæ¸²æŸ“ï¼›è€Œå¦‚æœæ˜¯å‡ºç°åœ¨äº† UI çº¿ç¨‹å›¾è¡¨ï¼Œåˆ™è¡¨ç¤º Dart ä»£ç æ¶ˆè€—äº†å¤§é‡èµ„æºï¼Œéœ€è¦ä¼˜åŒ–ä»£ç çš„æ‰§è¡Œæ—¶é—´**ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/1d5bd073d42d48e5ab486e5186afabe9~tplv-k3u1fbpfcp-watermark.image)

## 3ã€Raster çº¿ç¨‹é—®é¢˜å®šä½

å®ƒå®šä½çš„æ˜¯ **æ¸²æŸ“å¼•æ“åº•å±‚æ¸²æŸ“çš„å¼‚å¸¸**ã€‚

è§£å†³æ–¹æ¡ˆæ˜¯ **æŠŠéœ€è¦é™æ€ç¼“å­˜çš„å›¾åƒåŠ å…¥åˆ° RepaintBoundaryã€‚è€Œ RepaintBoundary å¯ä»¥ç¡®å®š Widget æ ‘çš„é‡ç»˜è¾¹ç•Œï¼Œå¦‚æœå›¾åƒè¶³å¤Ÿå¤æ‚ï¼ŒFlutter å¼•æ“ä¼šè‡ªåŠ¨å°†å…¶ç¼“å­˜ï¼Œé¿å…é‡å¤åˆ·æ–°ã€‚å½“ç„¶ï¼Œå› ä¸ºç¼“å­˜èµ„æºæœ‰é™ï¼Œå¦‚æœå¼•æ“è®¤ä¸ºå›¾åƒä¸å¤Ÿå¤æ‚ï¼Œä¹Ÿå¯èƒ½ä¼šå¿½ç•¥ RepaintBoundaryã€‚**

## 4ã€UI çº¿ç¨‹é—®é¢˜å®šä½

### é—®é¢˜åœºæ™¯

åœ¨è§†å›¾æ„å»ºæ—¶ï¼Œåœ¨ build æ–¹æ³•ä¸­ä½¿ç”¨äº†ä¸€äº›å¤æ‚çš„è¿ç®—ï¼Œæˆ–æ˜¯åœ¨ä¸» Isolate ä¸­è¿›è¡Œäº†åŒæ­¥çš„ I/O æ“ä½œã€‚

### ä½¿ç”¨ Performance è¿›è¡Œæ£€æµ‹

ç‚¹å‡» Android Studio åº•éƒ¨å·¥å…·æ ä¸­çš„ â€œOpen DevToolsâ€ æŒ‰é’®ï¼Œç„¶ååœ¨æ‰“å¼€çš„ Dart DevTools ç½‘é¡µä¸­å°†é¡¶éƒ¨çš„ tab åˆ‡æ¢åˆ° Performanceã€‚

ä¸æ€§èƒ½å›¾å±‚èƒ½å¤Ÿè‡ªåŠ¨è®°å½•åº”ç”¨æ‰§è¡Œçš„æƒ…å†µä¸åŒï¼Œä½¿ç”¨ Performance æ¥åˆ†æä»£ç æ‰§è¡Œè½¨è¿¹ï¼Œä½ éœ€è¦æ‰‹åŠ¨ç‚¹å‡» â€œRecordâ€ æŒ‰é’®å»ä¸»åŠ¨è§¦å‘ï¼Œåœ¨å®Œæˆä¿¡æ¯çš„æŠ½æ ·é‡‡é›†åï¼Œç‚¹å‡» â€œStopâ€ æŒ‰é’®ç»“æŸå½•åˆ¶ã€‚è¿™æ—¶ï¼Œä½ å°±å¯ä»¥å¾—åˆ°åœ¨è¿™æœŸé—´åº”ç”¨çš„æ‰§è¡Œæƒ…å†µäº†ã€‚

**ä½¿ç”¨ Performance è®°å½•åº”ç”¨çš„æ‰§è¡Œæƒ…å†µï¼Œå³ CPU å¸§å›¾ï¼Œåˆè¢«ç§°ä¸ºç«ç„°å›¾ã€‚ç«ç„°å›¾æ˜¯åŸºäºè®°å½•ä»£ç æ‰§è¡Œç»“æœæ‰€äº§ç”Ÿçš„å›¾ç‰‡ï¼Œç”¨æ¥å±•ç¤º CPU çš„è°ƒç”¨æ ˆï¼Œè¡¨ç¤ºçš„æ˜¯ CPU çš„ç¹å¿™ç¨‹åº¦**ã€‚

å…¶ä¸­ï¼š

- **y è½´**ï¼šè¡¨ç¤ºè°ƒç”¨æ ˆï¼Œå…¶æ¯ä¸€å±‚éƒ½æ˜¯ä¸€ä¸ªå‡½æ•°ã€‚**è°ƒç”¨æ ˆè¶Šæ·±ï¼Œç«ç„°å°±è¶Šé«˜ï¼Œåº•éƒ¨å°±æ˜¯æ­£åœ¨æ‰§è¡Œçš„å‡½æ•°ï¼Œä¸Šæ–¹éƒ½æ˜¯å®ƒçš„çˆ¶å‡½æ•°**ã€‚
- **x è½´**ï¼šè¡¨ç¤ºå•ä½æ—¶é—´ï¼Œä¸€**ä¸ªå‡½æ•°åœ¨ x è½´å æ®çš„å®½åº¦è¶Šå®½ï¼Œå°±è¡¨ç¤ºå®ƒè¢«é‡‡æ ·åˆ°çš„æ¬¡æ•°è¶Šå¤šï¼Œå³æ‰§è¡Œæ—¶é—´è¶Šé•¿**ã€‚

æ‰€ä»¥ï¼Œæˆ‘ä»¬è¦ **æ£€æµ‹ CPU è€—æ—¶é—®é¢˜ï¼Œçš†å¯ä»¥æŸ¥çœ‹ç«ç„°å›¾åº•éƒ¨çš„å“ªä¸ªå‡½æ•°å æ®çš„å®½åº¦æœ€å¤§ã€‚åªè¦æœ‰ â€œå¹³é¡¶â€ï¼Œå°±è¡¨ç¤ºè¯¥å‡½æ•°å¯èƒ½å­˜åœ¨æ€§èƒ½é—®é¢˜**ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/90fff91667f040a28535bf92bfe773a4~tplv-k3u1fbpfcp-watermark.image)

ä¸€èˆ¬çš„è€—æ—¶é—®é¢˜ï¼Œæˆ‘ä»¬é€šå¸¸å¯ä»¥ **ä½¿ç”¨ Isolateï¼ˆæˆ– computeï¼‰å°†è¿™äº›è€—æ—¶çš„æ“ä½œæŒªåˆ°å¹¶å‘ä¸» Isolate ä¹‹å¤–å»å®Œæˆ**ã€‚

> dart çš„å•çº¿ç¨‹æ‰§è¡Œå¼‚æ­¥ä»»åŠ¡æ˜¯æ€ä¹ˆå®ç°çš„ï¼Ÿ

ç½‘ç»œè°ƒç”¨çš„æ‰§è¡Œæ˜¯ç”±æ“ä½œç³»ç»Ÿæä¾›çš„å¦å¤–çš„åº•å±‚çº¿ç¨‹åšçš„ï¼Œè€Œåœ¨ event queue é‡Œåªä¼šæ”¾ä¸€ä¸ªç½‘ç»œè°ƒç”¨çš„æœ€ç»ˆæ‰§è¡Œç»“æœï¼ˆæˆåŠŸæˆ–å¤±è´¥ï¼‰å’Œå“åº”æ‰§è¡Œç»“æœçš„å¤„ç†å›è°ƒã€‚

## 5ã€ä½¿ç”¨ checkerboardOffscreenLayers æ£€æŸ¥å¤šè§†å›¾å åŠ çš„è§†å›¾æ¸²æŸ“

åªè¦åœ¨ MaterialApp çš„åˆå§‹åŒ–æ–¹æ³•ä¸­ï¼Œå°† checkerboardOffscreenLayers å¼€å…³è®¾ç½®ä¸º trueï¼Œåˆ†æå·¥å…·å°±ä¼šè‡ªåŠ¨å¸®ä½ æ£€æµ‹å¤šè§†å›¾å åŠ çš„æƒ…å†µã€‚

è¿™æ—¶ï¼Œä½¿ç”¨äº† saveLayer çš„ Widget ä¼šè‡ªåŠ¨æ˜¾ç¤ºä¸ºæ£‹ç›˜æ ¼å¼ï¼Œå¹¶éšç€é¡µé¢åˆ·æ–°è€Œé—ªçƒã€‚

è€Œ saveLayer ä¸€èˆ¬ä¼šé€šè¿‡ä¸€äº›åŠŸèƒ½æ€§ Widgetï¼Œåœ¨æ¶‰åŠéœ€è¦å‰ªåˆ‡æˆ–åŠé€æ˜è’™å±‚çš„åœºæ™¯ä¸­é—´æ¥åœ°ä½¿ç”¨ã€‚

## 6ã€ä½¿ç”¨ checkerboardRasterCacheImages æ£€æŸ¥ç¼“å­˜çš„å›¾åƒ

å®ƒä¹Ÿæ˜¯ç”¨æ¥æ£€æµ‹åœ¨ç•Œé¢é‡ç»˜æ—¶é¢‘ç¹é—ªçƒçš„å›¾åƒï¼ˆå³æ²¡æœ‰é™æ€ç¼“å­˜ï¼‰ã€‚è§£å†³æ–¹æ¡ˆæ˜¯æŠŠéœ€è¦é™æ€ç¼“å­˜çš„å›¾åƒåŠ å…¥åˆ° RepaintBoundaryã€‚



# äºŒã€å…³é”®ä¼˜åŒ–æŒ‡æ ‡

## 1ã€é¡µé¢å¼‚å¸¸ç‡

é¡µé¢å¼‚å¸¸ç‡ï¼Œå³ é¡µ**é¢æ¸²æŸ“è¿‡ç¨‹ä¸­å‡ºç°å¼‚å¸¸çš„æ¦‚ç‡ã€‚**

å®ƒåº¦é‡çš„æ˜¯é¡µé¢ç»´åº¦ä¸‹åŠŸèƒ½ä¸å¯ç”¨çš„æƒ…å†µï¼Œå…¶ç»Ÿè®¡å…¬å¼ä¸ºï¼š

> é¡µé¢å¼‚å¸¸ç‡ = å¼‚å¸¸å‘ç”Ÿæ¬¡æ•° / æ•´ä½“é¡µé¢ PV æ•°ã€‚

### ç»Ÿè®¡å¼‚å¸¸å‘ç”Ÿæ¬¡æ•°

åˆ©ç”¨ Zone ä¸ FlutterError è¿™ä¸¤ä¸ªæ–¹æ³•ï¼Œç„¶ååœ¨å¼‚å¸¸æ‹¦æˆªçš„æ–¹æ³•ä¸­ï¼Œå»ç´¯è®¡å¼‚å¸¸çš„å‘ç”Ÿæ¬¡æ•°ã€‚

### ç»Ÿè®¡æ•´ä½“é¡µé¢ PV æ•°

ç»§æ‰¿è‡ª NavigatorObserver çš„è§‚å¯Ÿè€…ï¼Œå¹¶åœ¨å…¶ didPush æ–¹æ³•ä¸­ï¼Œå»ç´¯åŠ é¡µé¢çš„æ‰“å¼€æ¬¡æ•°ã€‚

## 2ã€é¡µé¢å¸§ç‡

Flutter åœ¨å…¨å±€ Window å¯¹è±¡ä¸Šæä¾›äº†å¸§å›è°ƒæœºåˆ¶ã€‚æˆ‘ä»¬å¯ä»¥åœ¨ Window å¯¹è±¡ä¸Šæ³¨å†Œ onReportTimings æ–¹æ³•ï¼Œå°†æœ€è¿‘ç»˜åˆ¶å¸§è€—è´¹çš„æ—¶é—´ï¼ˆå³ FrameTimingï¼‰ï¼Œä»¥å›è°ƒçš„å½¢å¼å‘Šè¯‰æˆ‘ä»¬ã€‚

æœ‰äº†æ¯ä¸€å¸§çš„ç»˜åˆ¶æ—¶é—´åï¼Œæˆ‘ä»¬å°±å¯ä»¥è®¡ç®— FPS äº†ã€‚

ä¸ºäº†è®© FPS çš„è®¡ç®—æ›´åŠ å¹³æ»‘ï¼Œæˆ‘ä»¬éœ€è¦ä¿ç•™æœ€è¿‘ 25 ä¸ª FrameTiming ç”¨äºæ±‚å’Œè®¡ç®—ã€‚

ç”±äºå¸§çš„æ¸²æŸ“æ˜¯ä¾é  VSync ä¿¡å·é©±åŠ¨çš„ï¼Œå¦‚æœå¸§ç»˜åˆ¶çš„æ—¶é—´æ²¡æœ‰è¶…è¿‡ 16.67 msï¼Œæˆ‘ä»¬ä¹Ÿéœ€è¦æŠŠå®ƒå½“æˆ 16.67 ms æ¥ç®—ï¼Œå› ä¸ºç»˜åˆ¶å®Œæˆçš„å¸§å¿…é¡»è¦ç­‰åˆ°ä¸‹ä¸€æ¬¡ VSync ä¿¡å·æ¥äº†ä¹‹åæ‰èƒ½æ¸²æŸ“ã€‚è€Œå¦‚æœå¸§ç»˜åˆ¶æ—¶é—´è¶…è¿‡äº† 16.67 msï¼Œåˆ™ä¼šå ç”¨åç»­ VSync çš„ä¿¡å·å‘¨æœŸï¼Œä»è€Œæ‰“ä¹±åç»­çš„ç»˜åˆ¶æ¬¡åºï¼Œäº§ç”Ÿå¡é¡¿ç°è±¡ã€‚

é‚£ä¹ˆï¼Œé¡µé¢å¸§ç‡çš„ç»Ÿè®¡å…¬å¼å°±æ˜¯ï¼š

> FPS = 60 * å®é™…æ¸²æŸ“çš„å¸§æ•° / æœ¬æ¥åº”è¯¥åœ¨è¿™ä¸ªæ—¶é—´å†…æ¸²æŸ“å®Œæˆçš„å¸§æ•°ã€‚

é¦–å…ˆï¼Œå®šä¹‰ä¸€ä¸ªå®¹é‡ä¸º 25 çš„åˆ—è¡¨ï¼Œç”¨äºå­˜å‚¨æœ€è¿‘çš„å¸§ç»˜åˆ¶è€—æ—¶ FrameTimingã€‚

ç„¶åï¼Œåœ¨ FPS çš„è®¡ç®—å‡½æ•°ä¸­ï¼Œä½ å†å°†åˆ—è¡¨ä¸­æ¯å¸§ç»˜åˆ¶æ—¶é—´ä¸ VSync å‘¨æœŸ frameInterval è¿›è¡Œæ¯”è¾ƒï¼Œå¾—å‡ºæœ¬æ¥åº”è¯¥ç»˜åˆ¶çš„å¸§æ•°ã€‚

æœ€åï¼Œä¸¤è€…ç›¸é™¤å°±å¾—åˆ°äº† FPS æŒ‡æ ‡ã€‚

## 3ã€é¡µé¢åŠ è½½æ—¶é•¿

> é¡µé¢åŠ è½½æ—¶é•¿ = é¡µé¢å¯è§çš„æ—¶é—´ - é¡µé¢åˆ›å»ºçš„æ—¶é—´ï¼ˆåŒ…æ‹¬ç½‘ç»œåŠ è½½æ—¶é•¿ï¼‰

### ç»Ÿè®¡é¡µé¢å¯è§çš„æ—¶é—´

**WidgetsBinding æä¾›äº†å•æ¬¡ Frame å›è°ƒçš„ addPostFrameCallback æ–¹æ³•ï¼Œå®ƒä¼šåœ¨å½“å‰ Frame ç»˜åˆ¶å®Œæˆä¹‹åè¿›è¡Œå›è°ƒï¼Œå¹¶ä¸”åªä¼šå›è°ƒä¸€æ¬¡ã€‚ä¸€æ—¦ç›‘å¬åˆ° Frame ç»˜åˆ¶å®Œæˆå›è°ƒåï¼Œæˆ‘ä»¬å°±å¯ä»¥ç¡®è®¤é¡µé¢å·²ç»è¢«æ¸²æŸ“å‡ºæ¥äº†**ï¼Œå› æ­¤æˆ‘ä»¬å¯ä»¥å€ŸåŠ©è¿™ä¸ªæ–¹æ³•å»è·å–é¡µé¢çš„æ¸²æŸ“å®Œæˆæ—¶é—´ endTimeã€‚

### ç»Ÿè®¡é¡µé¢åˆ›å»ºçš„æ—¶é—´

è·å–é¡µé¢åˆ›å»ºçš„æ—¶é—´æ¯”è¾ƒå®¹æ˜“ï¼Œæˆ‘ä»¬åªéœ€è¦åœ¨é¡µé¢çš„åˆå§‹åŒ–å‡½æ•° initState() é‡Œè®°å½•é¡µé¢çš„åˆ›å»ºæ—¶é—´ startTimeã€‚

æœ€åï¼Œå†å°†è¿™ä¸¤ä¸ªæ—¶é—´åšå‡æ³•ï¼Œä½ å°±èƒ½å¾—åˆ°é¡µé¢çš„åŠ è½½æ—¶é•¿ã€‚

éœ€è¦æ³¨æ„çš„æ˜¯ï¼Œ**æ­£å¸¸çš„é¡µé¢åŠ è½½æ—¶é•¿ä¸€èˆ¬éƒ½ä¸åº”è¯¥è¶…è¿‡2ç§’ã€‚å¦‚æœè¶…è¿‡äº†ï¼Œåˆ™æ„å‘³ç€æœ‰ä¸¥é‡çš„æ€§èƒ½é—®é¢˜ã€‚**



# ä¸‰ã€å¸ƒå±€åŠ è½½ä¼˜åŒ–

> Flutter ä¸ºä»€ä¹ˆè¦ä½¿ç”¨å£°æ˜ä¹¦ UI çš„ç¼–å†™æ–¹å¼ï¼Ÿ

ä¸ºäº†å‡è½»å¼€å‘äººå‘˜çš„è´Ÿæ‹…ï¼Œæ— éœ€ç¼–å†™å¦‚ä½•åœ¨ä¸åŒçš„ UI çŠ¶æ€ä¹‹é—´è¿›è¡Œåˆ‡æ¢çš„ä»£ç ï¼ŒFlutter ä½¿ç”¨äº†å£°æ˜å¼çš„ UI ç¼–å†™æ–¹å¼ï¼Œè€Œä¸æ˜¯ Android å’Œ iOS ä¸­çš„å‘½ä»¤å¼ç¼–å†™æ–¹å¼ã€‚

è¿™æ ·çš„è¯ï¼Œ**å½“ç”¨æˆ·ç•Œé¢å‘ç”Ÿå˜åŒ–æ—¶ï¼ŒFlutter ä¸ä¼šä¿®æ”¹æ—§çš„ Widget å®ä¾‹ï¼Œè€Œæ˜¯ä¼šæ„é€ æ–°çš„ Widget å®ä¾‹**ã€‚

Fluter æ¡†æ¶ä½¿ç”¨ RenderObjects ç®¡ç†ä¼ ç»Ÿ UI å¯¹è±¡çš„èŒè´£ï¼ˆæ¯”å¦‚ç»´æŠ¤å¸ƒå±€çš„çŠ¶æ€ï¼‰ã€‚ RenderObjects åœ¨å¸§ä¹‹é—´ä¿æŒä¸å˜ï¼Œ Flutter çš„è½»é‡çº§ Widget é€šçŸ¥æ¡†æ¶åœ¨çŠ¶æ€ä¹‹é—´ä¿®æ”¹ RenderObjectsï¼Œ è€Œ Flutter Framework åˆ™è´Ÿè´£å¤„ç†å…¶ä½™éƒ¨åˆ†ã€‚

## 1ã€å¸¸è§„ä¼˜åŒ–

å¸¸è§„ä¼˜åŒ–å³é’ˆå¯¹ build() è¿›è¡Œä¼˜åŒ–ï¼Œbuild() æ–¹æ³•ä¸­çš„æ€§èƒ½é—®é¢˜ä¸€èˆ¬æœ‰ä¸¤ç§ï¼š**è€—æ—¶æ“ä½œå’Œ Widget å †å **ã€‚

### 1ï¼‰ã€åœ¨ build() æ–¹æ³•ä¸­æ‰§è¡Œäº†è€—æ—¶æ“ä½œ

æˆ‘ä»¬åº”è¯¥å°½é‡é¿å…åœ¨ build() ä¸­æ‰§è¡Œè€—æ—¶æ“ä½œï¼Œå› ä¸º build() ä¼šè¢«é¢‘ç¹åœ°è°ƒç”¨ï¼Œå°¤å…¶æ˜¯å½“ Widget é‡å»ºçš„æ—¶å€™ã€‚

æ­¤å¤–ï¼Œæˆ‘ä»¬ä¸è¦åœ¨ä»£ç ä¸­è¿›è¡Œé˜»å¡å¼æ“ä½œï¼Œå¯ä»¥å°†æ–‡ä»¶è¯»å–ã€æ•°æ®åº“æ“ä½œã€ç½‘ç»œè¯·æ±‚ç­‰é€šè¿‡ Future æ¥è½¬æ¢æˆå¼‚æ­¥æ–¹å¼æ¥å®Œæˆã€‚

æœ€åï¼Œå¯¹äº CPU è®¡ç®—é¢‘ç¹çš„æ“ä½œï¼Œä¾‹å¦‚å›¾ç‰‡å‹ç¼©ï¼Œå¯ä»¥ä½¿ç”¨ isolate æ¥å……åˆ†åˆ©ç”¨å¤šæ ¸å¿ƒ CPUã€‚

**isolate ä½œä¸º Flutter ä¸­çš„å¤šçº¿ç¨‹å®ç°æ–¹å¼ï¼Œä¹‹æ‰€ä»¥è¢«ç§°ä¹‹ä¸º isolateï¼ˆéš”ç¦»ï¼‰ï¼Œæ˜¯å› ä¸ºæ¯ä¸€ä¸ª isolate éƒ½æœ‰ä¸€ä»½å•ç‹¬çš„å†…å­˜**ã€‚

**Flutter ä¼šè¿è¡Œä¸€ä¸ªäº‹ä»¶å¾ªç¯ï¼Œå®ƒä¼šä»äº‹ä»¶é˜Ÿåˆ—ä¸­å–å¾—æœ€æ—§çš„äº‹ä»¶ï¼Œå¤„ç†å®ƒï¼Œç„¶åå†è¿”å›ä¸‹ä¸€ä¸ªäº‹ä»¶è¿›è¡Œå¤„ç†ï¼Œä¾æ­¤ç±»æ¨ï¼Œç›´åˆ°äº‹ä»¶é˜Ÿåˆ—æ¸…ç©ºä¸ºæ­¢ã€‚æ¯å½“åŠ¨ä½œä¸­æ–­æ—¶ï¼Œçº¿ç¨‹å°±ä¼šç­‰å¾…ä¸‹ä¸€ä¸ªäº‹ä»¶**ã€‚

å®è´¨ä¸Šï¼Œä¸ä»…ä»…æ˜¯ isolateï¼Œæ‰€æœ‰çš„é«˜çº§ API éƒ½èƒ½å¤Ÿåº”ç”¨äºå¼‚æ­¥ç¼–ç¨‹ï¼Œä¾‹å¦‚ Futuresã€Streamsã€async å’Œ awaitï¼Œå®ƒä»¬å…¨éƒ¨éƒ½æ˜¯æ„å»ºåœ¨è¿™ä¸ªç®€å•çš„äº‹ä»¶å¾ªç¯ä¹‹ä¸Šã€‚

è€Œï¼Œasync å’Œ await å®é™…ä¸Šåªæ˜¯ä½¿ç”¨ futures å’Œ streams çš„æ›¿ä»£è¯­æ³•ï¼Œå®ƒå°†ä»£ç ç¼–å†™å½¢å¼ä»å¼‚æ­¥å˜ä¸ºåŒæ­¥ï¼Œä¸»è¦ç”¨æ¥å¸®åŠ©ä½ ç¼–å†™æ›´æ¸…æ™°ã€ç®€æ´çš„ä»£ç ã€‚

æ­¤å¤–ï¼Œasync å’Œ await ä¹Ÿèƒ½ä½¿ç”¨ try on catch finally æ¥è¿›è¡Œå¼‚å¸¸å¤„ç†ï¼Œè¿™èƒ½å¤Ÿå¸®åŠ©ä½ å¤„ç†ä¸€äº›æ•°æ®è§£ææ–¹é¢çš„å¼‚å¸¸ã€‚

### 2). build() æ–¹æ³•ä¸­å †ç Œäº†å¤§é‡çš„ Widget

è¿™å°†ä¼šå¯¼è‡´ä¸‰ä¸ªé—®é¢˜ï¼š

- 1ã€**ä»£ç å¯è¯»æ€§å·®**ï¼šç”»ç•Œé¢æ—¶éœ€è¦ä¸€ä¸ª Widget åµŒå¥—ä¸€ä¸ª Widgetï¼Œä½†å¦‚æœ Widget åµŒå¥—å¤ªæ·±ï¼Œå°±ä¼šå¯¼è‡´ä»£ç çš„å¯è¯»æ€§å˜å·®ï¼Œä¹Ÿä¸åˆ©äºåæœŸçš„ç»´æŠ¤å’Œæ‰©å±•ã€‚
- 2ã€**å¤ç”¨éš¾**ï¼šç”±äºæ‰€æœ‰çš„ä»£ç éƒ½åœ¨ä¸€ä¸ª build()ï¼Œä¼šå¯¼è‡´æ— æ³•å°†å…¬å…±çš„ UI ä»£ç å¤ç”¨åˆ°å…¶å®ƒçš„é¡µé¢æˆ–æ¨¡å—ã€‚
- 3ã€**å½±å“æ€§èƒ½**ï¼šæˆ‘ä»¬åœ¨ State ä¸Šè°ƒç”¨ setState() æ—¶ï¼Œæ‰€æœ‰ build() ä¸­çš„ Widget éƒ½å°†è¢«é‡å»ºï¼Œå› æ­¤ build() ä¸­è¿”å›çš„ Widget æ ‘è¶Šå¤§ï¼Œé‚£ä¹ˆéœ€è¦é‡å»ºçš„ Widget å°±è¶Šå¤šï¼Œä¹Ÿå°±ä¼šå¯¹æ€§èƒ½è¶Šä¸åˆ©ã€‚

æ‰€ä»¥ï¼Œä½ éœ€è¦ **æ§åˆ¶ build æ–¹æ³•è€—æ—¶ï¼Œå°† Widget æ‹†å°ï¼Œé¿å…ç›´æ¥è¿”å›ä¸€ä¸ªå·¨å¤§çš„ Widgetï¼Œè¿™æ · Widget ä¼šäº«æœ‰æ›´ç»†ç²’åº¦çš„é‡å»ºå’Œå¤ç”¨ã€‚**

### 3). ä½¿ç”¨ Widget è€Œä¸æ˜¯å‡½æ•°

å¦‚æœä¸€ä¸ªå‡½æ•°å¯ä»¥åšåŒæ ·çš„äº‹æƒ…ï¼ŒFlutter å°±ä¸ä¼šæœ‰ StatelessWidget ï¼Œä½¿ç”¨ StatelessWidget çš„æœ€å¤§å¥½å¤„åœ¨äºï¼šèƒ½å°½é‡é¿å…ä¸å¿…è¦çš„é‡å»ºã€‚æ€»çš„æ¥è¯´ï¼Œå®ƒçš„ä¼˜åŠ¿æœ‰ï¼š

- 1ï¼‰ã€å…è®¸æ€§èƒ½ä¼˜åŒ–ï¼šconst æ„é€ å‡½æ•°ï¼Œæ›´ç»†ç²’åº¦çš„é‡å»ºç­‰ç­‰ã€‚
- 2ï¼‰ã€ç¡®ä¿åœ¨ä¸¤ä¸ªä¸åŒçš„å¸ƒå±€ä¹‹é—´åˆ‡æ¢æ—¶ï¼Œèƒ½å¤Ÿæ­£ç¡®åœ°å¤„ç†èµ„æºï¼ˆå› ä¸ºå‡½æ•°å¯èƒ½é‡ç”¨æŸäº›å…ˆå‰çš„çŠ¶æ€ï¼‰ã€‚
- 3ï¼‰ã€ç¡®ä¿çƒ­é‡è½½æ­£å¸¸å·¥ä½œï¼Œä½¿ç”¨å‡½æ•°å¯èƒ½ä¼šç ´åçƒ­é‡è½½ã€‚
- 4ï¼‰ã€åœ¨ flutter è‡ªå¸¦çš„ Widget æ˜¾ç¤ºå·¥å…·ä¸­èƒ½çœ‹åˆ° Widget çš„çŠ¶æ€å’Œå‚æ•°ã€‚
- 5ï¼‰ã€å‘ç”Ÿé”™è¯¯æ—¶ï¼Œæœ‰æ›´æ¸…æ™°çš„æç¤ºï¼šæ­¤æ—¶ï¼ŒFlutter æ¡†æ¶å°†ä¸ºä½ æä¾›å½“å‰æ„å»ºçš„ Widget åç§°ï¼Œæ›´å®¹æ˜“æ’æŸ¥é—®é¢˜ã€‚
- 6ï¼‰ã€å¯ä»¥å®šä¹‰ key å’Œæ–¹ä¾¿ä½¿ç”¨ context çš„ APIã€‚

### 4). å°½å¯èƒ½åœ°ä½¿ç”¨ const

å¦‚æœæŸä¸€ä¸ªå®ä¾‹å·²ç»ç”¨ const å®šä¹‰å¥½äº†ï¼Œé‚£ä¹ˆå…¶å®ƒåœ°æ–¹å†æ¬¡ä½¿ç”¨ const å®šä¹‰æ—¶ï¼Œåˆ™ä¼šç›´æ¥ä»å¸¸é‡æ± é‡Œå–ï¼Œè¿™æ ·ä¾¿èƒ½å¤ŸèŠ‚çœ RAMã€‚

### 5). å°½å¯èƒ½åœ°ä½¿ç”¨ const æ„é€ å™¨

å½“æ„å»ºä½ è‡ªå·±çš„ Widget æˆ–è€…ä½¿ç”¨ Flutter çš„ Widget æ—¶ï¼Œè¿™å°†ä¼šå¸®åŠ© Flutter ä»…ä»…å» rebuild é‚£äº›åº”å½“è¢«æ›´æ–°çš„ Widgetã€‚

å› æ­¤ï¼Œä½ åº”è¯¥å°½é‡å¤šç”¨ const ç»„ä»¶ï¼Œè¿™æ ·å³ä½¿çˆ¶ç»„ä»¶æ›´æ–°äº†ï¼Œå­ç»„ä»¶ä¹Ÿä¸ä¼šé‡æ–°è¿›è¡Œ rebuild æ“ä½œã€‚ç‰¹åˆ«æ˜¯é’ˆå¯¹ä¸€äº›é•¿æœŸä¸ä¿®æ”¹çš„ç»„ä»¶ï¼Œä¾‹å¦‚é€šç”¨æŠ¥é”™ç»„ä»¶å’Œé€šç”¨ loading ç»„ä»¶ç­‰ã€‚

### 6). ä½¿ç”¨ nil å»æ›¿ä»£ Container() å’Œ SizedBox()

é¦–å…ˆï¼Œä½ éœ€è¦æ˜ç™½ **nil ä»…ä»…æ˜¯ä¸€ä¸ªåŸºç¡€çš„ Widget å…ƒç´  ï¼Œå®ƒçš„æ„å»ºæˆæœ¬å‡ ä¹æ²¡æœ‰ã€‚**

åœ¨æŸäº›æƒ…å†µä¸‹ï¼Œå¦‚æœä½ ä¸æƒ³æ˜¾ç¤ºä»»ä½•å†…å®¹ï¼Œä¸”ä¸èƒ½è¿”å› null çš„æ—¶å€™ï¼Œä½ å¯èƒ½ä¼šè¿”å›ç±»ä¼¼ const SizedBox/Container çš„ Widgetï¼Œä½†æ˜¯ SizedBox ä¼šåˆ›å»º RenderObjectï¼Œè€Œæ¸²æŸ“æ ‘ä¸­çš„ RenderObject ä¼šå¸¦æ¥å¤šä½™çš„ç”Ÿå‘½å‘¨æœŸæ§åˆ¶å’Œé¢å¤–çš„è®¡ç®—æ¶ˆè€—ï¼Œå³ä¾¿ä½ æ²¡æœ‰ç»™ SizedBox æŒ‡å®šä»»ä½•çš„å‚æ•°ã€‚

ä¸‹é¢ï¼Œæ˜¯æˆ‘å¹³æ—¶ä½¿ç”¨ nil çš„ä¸€å¥—æ–¹å¼ï¼š

```
// BEST
text != null ? Text(text) : nil
or
if (text != null) Text(text)
text != null ? Text(text) : const Container()/SizedBox()
å¤åˆ¶ä»£ç 
```

### 7). åˆ—è¡¨ä¼˜åŒ–

åœ¨æ„å»ºå¤§å‹ç½‘æ ¼æˆ–åˆ—è¡¨çš„æ—¶å€™ï¼Œæˆ‘ä»¬è¦å°½é‡é¿å…ä½¿ç”¨ ListView(children: [],) æˆ– GridView(children: [],)ã€‚

å› ä¸ºï¼Œåœ¨è¿™ç§åœºæ™¯ä¸‹ï¼Œä¸ç®¡åˆ—è¡¨å†…å®¹æ˜¯å¦å¯è§ï¼Œä¼šå¯¼è‡´åˆ—è¡¨ä¸­æ‰€æœ‰çš„æ•°æ®éƒ½ä¼šè¢«ä¸€æ¬¡æ€§ç»˜åˆ¶å‡ºæ¥ï¼Œè¿™ç§ç”¨æ³•ç±»ä¼¼äº Android çš„ ScrollViewã€‚

å¦‚æœæˆ‘ä»¬åˆ—è¡¨æ•°æ®æ¯”è¾ƒå¤§çš„æ—¶å€™ï¼Œå»ºè®®ä½¿ç”¨ ListView å’Œ GridView çš„ builder æ–¹æ³•ï¼Œå®ƒä»¬åªä¼šç»˜åˆ¶å¯è§çš„åˆ—è¡¨å†…å®¹ï¼Œç±»ä¼¼äº Android çš„ RecyclerViewã€‚

å…¶å®ï¼Œæœ¬è´¨ä¸Šï¼Œ**å°±æ˜¯å¯¹åˆ—è¡¨é‡‡ç”¨äº†æ‡’åŠ è½½è€Œä¸æ˜¯ç›´æ¥ä¸€æ¬¡æ€§åˆ›å»ºæ‰€æœ‰çš„å­ Widgetï¼Œè¿™æ ·è§†å›¾çš„åˆå§‹åŒ–æ—¶é—´å°±å‡å°‘äº†**ã€‚

### 8). é’ˆå¯¹äºé•¿åˆ—è¡¨ï¼Œè®°å¾—åœ¨ ListView ä¸­ä½¿ç”¨ itemExtentã€‚

æœ‰æ—¶å€™å½“æˆ‘ä»¬æœ‰ä¸€ä¸ªå¾ˆé•¿çš„åˆ—è¡¨ï¼Œæƒ³è¦ç”¨æ»šåŠ¨æ¡æ¥å¤§è·³æ—¶ï¼Œä½¿ç”¨ itemExtent å°±å¾ˆé‡è¦äº†ï¼Œ**å®ƒä¼šå¸®åŠ© Flutter å»è®¡ç®— ListView çš„æ»šåŠ¨ä½ç½®è€Œä¸æ˜¯è®¡ç®—æ¯ä¸€ä¸ª Widget çš„é«˜åº¦ï¼Œä¸æ­¤åŒæ—¶ï¼Œå®ƒèƒ½å¤Ÿä½¿æ»šåŠ¨åŠ¨ç”»æœ‰æ›´å¥½çš„æ€§èƒ½**ã€‚

### 9). å‡å°‘å¯æŠ˜å  ListView çš„æ„å»ºæ—¶é—´

**é’ˆå¯¹äºå¯æŠ˜å çš„ ListViewï¼Œæœªå±•å¼€çŠ¶æ€æ—¶ï¼Œè®¾ç½®å…¶ itemCount ä¸º 0ï¼Œè¿™æ · item åªä¼šåœ¨å±•å¼€çŠ¶æ€ä¸‹æ‰è¿›è¡Œæ„å»ºï¼Œä»¥å‡å°‘é¡µé¢ç¬¬ä¸€æ¬¡çš„æ‰“å¼€æ„å»ºæ—¶é—´**ã€‚

### 10). å°½é‡ä¸è¦ä¸º Widget è®¾ç½®åŠé€æ˜æ•ˆæœ

è€ƒè™‘ç”¨å›¾ç‰‡çš„å½¢å¼ä»£æ›¿ï¼Œè¿™æ ·è¢«é®æŒ¡çš„éƒ¨åˆ† Widget åŒºåŸŸå°±ä¸éœ€è¦ç»˜åˆ¶äº†ã€‚

é™¤æ­¤ä¹‹å¤–ï¼Œè¿˜æœ‰ç½‘ç»œè¯·æ±‚é¢„åŠ è½½ä¼˜åŒ–ã€æŠ½å–æ–‡æœ¬ Theme ç­‰å¸¸è§„çš„ä¼˜åŒ–æ–¹å¼å°±ä¸èµ˜è¿°äº†ã€‚

## 2ã€æ·±å…¥ä¼˜åŒ–

### 1). ä¼˜åŒ–å…‰æ …çº¿ç¨‹

æ‰€æœ‰çš„ Flutter åº”ç”¨è‡³å°‘éƒ½ä¼šè¿è¡Œåœ¨ä¸¤ä¸ªå¹¶è¡Œçš„çº¿ç¨‹ä¸Šï¼š**UI çº¿ç¨‹å’Œ Raster çº¿ç¨‹**ã€‚

**UI çº¿ç¨‹æ˜¯ä½ æ„å»º Widgets å’Œè¿è¡Œåº”ç”¨é€»è¾‘çš„åœ°æ–¹ã€‚ ** **Raster çº¿ç¨‹æ˜¯ Flutter ç”¨æ¥æ …æ ¼åŒ–ä½ çš„åº”ç”¨çš„ã€‚å®ƒä» UI çº¿ç¨‹è·å–æŒ‡ä»¤å¹¶å°†å®ƒä»¬è½¬æ¢ä¸ºå¯ä»¥å‘é€åˆ°å›¾å½¢å¡çš„å†…å®¹ã€‚**

**åœ¨å…‰æ …çº¿ç¨‹ä¸­ï¼Œä¼šè·å–å›¾ç‰‡çš„å­—èŠ‚ï¼Œè°ƒæ•´å›¾åƒçš„å¤§å°ï¼Œåº”ç”¨é€æ˜åº¦ã€æ··åˆæ¨¡å¼ã€æ¨¡ç³Šç­‰ç­‰ï¼Œç›´åˆ°äº§ç”Ÿæœ€åçš„å›¾å½¢åƒç´ ã€‚ç„¶åï¼Œå…‰æ …çº¿ç¨‹ä¼šå°†å…¶å‘é€åˆ°å›¾å½¢å¡ï¼Œç»§è€Œå‘é€åˆ°å±å¹•ä¸Šæ˜¾ç¤ºã€‚**

ä½¿ç”¨ Flutter DevTools-Performance è¿›è¡Œæ£€æµ‹ï¼Œæ­¥éª¤å¦‚ä¸‹ï¼š

- 1ã€åœ¨ Performance Overlay ä¸­ï¼ŒæŸ¥çœ‹å…‰æ …çº¿ç¨‹å’Œ UI çº¿ç¨‹å“ªä¸ªè´Ÿè½½è¿‡é‡ã€‚
- 2ã€åœ¨ Timeline Events ä¸­ï¼Œæ‰¾åˆ°é‚£äº›è€—è´¹æ—¶é—´æœ€é•¿çš„äº‹ä»¶ï¼Œä¾‹å¦‚å¸¸è§çš„ SkCanvas::Flushï¼Œå®ƒè´Ÿè´£è§£å†³æ‰€æœ‰å¾…å¤„ç†çš„ GPU æ“ä½œã€‚
- 3ã€æ‰¾åˆ°å¯¹åº”çš„ä»£ç åŒºåŸŸï¼Œé€šè¿‡åˆ é™¤ Widgets æˆ–æ–¹æ³•çš„æ–¹å¼æ¥çœ‹å¯¹æ€§èƒ½çš„å½±å“ã€‚

### 2). ç”¨ key åŠ é€Ÿ Flutter çš„æ€§èƒ½ä¼˜åŒ–å…‰æ …çº¿ç¨‹

ä¸€ä¸ª element æ˜¯ç”± Widget å†…éƒ¨åˆ›å»ºçš„ï¼Œå®ƒçš„ä¸»è¦ç›®çš„æ˜¯ï¼Œ**çŸ¥é“å¯¹åº”çš„ Widget åœ¨ Widget æ ‘ä¸­æ‰€å¤„çš„ä½ç½®ã€‚ä½†æ˜¯å…ƒç´ çš„åˆ›å»ºæ˜¯éå¸¸æ˜‚è´µçš„ï¼Œé€šè¿‡ Keysï¼ˆValueKeys å’Œ GlobalKeysï¼‰ï¼Œæˆ‘ä»¬å¯ä»¥å»é‡å¤ä½¿ç”¨å®ƒä»¬ã€‚**

> GlobalKey ä¸ ValueKey çš„åŒºåˆ«ï¼Ÿ

**GlobalKey æ˜¯å…¨å±€ä½¿ç”¨çš„ keyï¼Œåœ¨è·¨å°éƒ¨ä»¶çš„åœºæ™¯æ—¶ï¼Œä½ å°±å¯ä»¥ä½¿ç”¨å®ƒå»åˆ·æ–°å…¶å®ƒå°éƒ¨ä»¶ã€‚ä½†ï¼Œå®ƒæ˜¯å¾ˆæ˜‚è´µçš„ï¼Œå¦‚æœä½ ä¸éœ€è¦è®¿é—® BuildContextã€Element å’Œ Stateï¼Œåº”è¯¥å°½é‡ä½¿ç”¨ LocalKeyã€‚**

è€Œ ValueKey å’Œ ObjectKeyã€UniqueKey ä¸€æ ·éƒ½å½’å±äºå±€éƒ¨ä½¿ç”¨çš„ LocalKeyï¼Œæ— æ³•è·¨å®¹å™¨ä½¿ç”¨ï¼ŒValueKey æ¯”è¾ƒçš„æ˜¯ Widget çš„å€¼ï¼Œè€Œ ObjectKey æ¯”è¾ƒçš„æ˜¯å¯¹è±¡çš„ keyï¼ŒUniqueKey åˆ™æ¯æ¬¡éƒ½ä¼šç”Ÿæˆä¸€ä¸ªä¸åŒçš„å€¼ã€‚

#### å…ƒç´ çš„ç”Ÿå‘½å‘¨æœŸ

- **Mount**ï¼šæŒ‚è½½ï¼Œå½“å…ƒç´ ç¬¬ä¸€æ¬¡è¢«æ·»åŠ åˆ°æ ‘ä¸Šçš„æ—¶å€™è°ƒç”¨ã€‚
- **Active**ï¼šå½“éœ€è¦æ¿€æ´»ä¹‹å‰å¤±æ´»çš„å…ƒç´ æ—¶è¢«è°ƒç”¨ã€‚
- **Update**ï¼šç”¨æ–°æ•°æ®å»æ›´æ–° RenderObjectã€‚
- **Deactive**ï¼šå½“å…ƒç´ ä» Widget æ ‘ä¸­è¢«ç§»é™¤æˆ–ç§»åŠ¨æ—¶è¢«è°ƒç”¨ã€‚å¦‚æœä¸€ä¸ªå…ƒç´ åœ¨åŒä¸€å¸§æœŸé—´è¢«ç§»åŠ¨äº†ä¸”å®ƒæœ‰ GlobalKeyï¼Œé‚£ä¹ˆå®ƒä»ç„¶èƒ½å¤Ÿè¢«æ¿€æ´»ã€‚
- **UnMount**ï¼šå¸è½½ï¼Œå¦‚æœä¸€ä¸ªå…ƒç´ åœ¨ä¸€å¸§æœŸé—´æ²¡æœ‰è¢«æ¿€æ´»ï¼Œå®ƒå°†ä¼šè¢«å¸è½½ï¼Œå¹¶ä¸”å†ä¹Ÿä¸ä¼šè¢«å¤ç”¨ã€‚

#### ä¼˜åŒ–æ–¹å¼

**ä¸ºäº†å»æ”¹å–„æ€§èƒ½ï¼Œä½ éœ€è¦å»å°½å¯èƒ½è®© Widget ä½¿ç”¨ Activie å’Œ Update æ“ä½œï¼Œå¹¶ä¸”å°½é‡é¿å…è®© Widgetè§¦å‘ UnMount å’Œ Mountã€‚**è€Œä½¿ç”¨ GlobayKeys å’Œ ValueKey åˆ™èƒ½åšåˆ°è¿™ä¸€ç‚¹ï¼š

```
/// 1ã€ç»™ MaterialApp æŒ‡å®š GlobalKeys
MaterialApp(key: global, home: child,);
/// 2ã€é€šè¿‡æŠŠ ValueKey åˆ†é…åˆ°æ­£åœ¨è¢«å¸è½½çš„æ ¹ Widgetï¼Œä½ å°±èƒ½å¤Ÿ
/// å‡å°‘ Widget çš„å¹³å‡æ„å»ºæ—¶é—´ã€‚
Widget build(BuildContext context) {
  return Column(
    children: [
      value
          ? const SizedBox(key: ValueKey('SizedBox'))
          : const Placeholder(key: ValueKey('Placeholder')),
      GestureDetector(
        key: ValueKey('GestureDetector'),
        onTap: () {
          setState(() {
            value = !value;
          });
        },
        child: Container(
          width: 100,
          height: 100,
          color: Colors.red,
        ),
      ),
      !value
          ? const SizedBox(key: ValueKey('SizedBox'))
          : const Placeholder(key: ValueKey('Placeholder')),
    ],
  );
}
å¤åˆ¶ä»£ç 
```

> å¦‚ä½•çŸ¥é“å“ªäº› Widget ä¼šè¢« Updateï¼Œå“ªäº› Widgetä¼šè¢« UnMountï¼Ÿ

åªæœ‰ build ç›´æ¥ return çš„é‚£ä¸ªæ ¹ Widget ä¼šè‡ªåŠ¨æ›´æ–°ï¼Œå…¶å®ƒéƒ½æœ‰å¯èƒ½è¢« UnMountï¼Œå› æ­¤éƒ½éœ€è¦ç»™å…¶åˆ†é… ValueKeyã€‚

> ä¸ºä»€ä¹ˆæ²¡æœ‰ç»™ Container åˆ†é… ValueKeyï¼Ÿ

å› ä¸º Container æ˜¯ GestureDetector çš„ä¸€ä¸ªå­ Widgetï¼Œæ‰€ä»¥å½“ç»™ GestureDetector ä½¿ç”¨ ValueKey å»å®ç°å¤ç”¨æ›´æ–°æ—¶ï¼ŒContainer ä¹Ÿèƒ½è¢«è‡ªåŠ¨æ›´æ–°ã€‚

#### ä¼˜åŒ–æ•ˆæœ

ä¼˜åŒ–å‰ï¼š

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/f07e8348c899446b88090d9d007f81f4~tplv-k3u1fbpfcp-watermark.image)

ä¼˜åŒ–åï¼š

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/e1238deeab6346d5a183a5ede5e03038~tplv-k3u1fbpfcp-watermark.image)

å¯ä»¥çœ‹åˆ°ï¼Œå¹³å‡æ„å»ºæ—¶é—´ **ç”± 5.5ms å‡å°‘åˆ° 1.6ms**ï¼Œä¼˜åŒ–æ•ˆæœè¿˜æ˜¯å¾ˆæ˜æ˜¾çš„ã€‚

#### ä¼˜åŠ¿

å¤§å¹…åº¦å‡å°‘ Widgetçš„å¹³å‡æ„å»ºæ—¶é—´ã€‚

#### ç¼ºç‚¹

- **è¿‡å¤šä½¿ç”¨ ValueKey ä¼šè®©ä½ çš„ä»£ç å˜å¾—æ›´å†—ä½™ã€‚**
- **å¦‚æœä½ çš„æ ¹ Widget æ˜¯ MaterialApp æ—¶ï¼Œåˆ™éœ€è¦ä½¿ç”¨ GlobalKeyï¼Œä½†å½“ä½ å»é‡å¤ä½¿ç”¨ GlobalKey æ—¶å¯èƒ½ä¼šå¯¼è‡´ä¸€äº›é”™è¯¯ï¼Œæ‰€ä»¥ä¸€å®šè¦é¿å…æ»¥ç”¨ Keyã€‚**

æ³¨æ„ğŸ“¢ï¼šåœ¨å¤§éƒ¨åˆ†åœºæ™¯ä¸‹ï¼ŒFlutter çš„æ€§èƒ½éƒ½æ˜¯è¶³å¤Ÿçš„ï¼Œä¸éœ€è¦è¿™ä¹ˆç»†è‡´çš„ä¼˜åŒ–ï¼Œåªæœ‰å½“äº§ç”Ÿäº†è§†è§‰ä¸Šçš„é—®é¢˜ï¼Œä¾‹å¦‚å¡é¡¿æ—¶æ‰éœ€è¦å»åˆ†æä¼˜åŒ–ã€‚



# å››ã€å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–

## 1ã€Flutter å¼•æ“é¢„åŠ è½½

ä½¿ç”¨å®ƒå¯ä»¥è¾¾åˆ°é¡µé¢ç§’å¼€çš„ä¸€ä¸ªæ•ˆæœï¼Œå…·ä½“å®ç°ä¸ºï¼š

åœ¨ HIFlutterCacheManager ç±»ä¸­å®šä¹‰ä¸€ä¸ª preLoad æ–¹æ³•ï¼Œ**ä½¿ç”¨ Looper.myQueue().addIdleHandler æ·»åŠ ä¸€ä¸ª idelHandlerï¼Œå½“ CPU ç©ºé—²æ—¶ä¼šå›è°ƒ queueIdle æ–¹æ³•ï¼Œåœ¨è¿™ä¸ªæ–¹æ³•é‡Œï¼Œä½ å°±å¯ä»¥å»åˆå§‹åŒ– FlutterEngineï¼Œå¹¶æŠŠå®ƒç¼“å­˜åˆ°é›†åˆä¸­ã€‚**

é¢„åŠ è½½å®Œæˆä¹‹åï¼Œä½ å°±å¯ä»¥é€šè¿‡ HIFlutterCacheManager ç±»çš„ getCachedFlutterEngine æ–¹æ³•ä»é›†åˆä¸­è·å–åˆ°ç¼“å­˜å¥½çš„å¼•æ“ã€‚

## 2ã€Dart VM é¢„çƒ­

å¯¹äº Native + Flutter çš„æ··åˆåœºæ™¯ï¼Œå¦‚æœä¸æƒ³ä½¿ç”¨å¼•æ“é¢„åŠ è½½çš„æ–¹å¼ï¼Œé‚£ä¹ˆè¦æå‡ Flutter çš„å¯åŠ¨é€Ÿåº¦ä¹Ÿå¯ä»¥é€š è¿‡Dart VM é¢„çƒ­æ¥å®Œæˆï¼Œè¿™ç§æ–¹å¼ä¼šæå‡ä¸€å®šçš„ Flutter å¼•æ“åŠ è½½é€Ÿåº¦ï¼Œä½†æ•´ä½“å¯¹å¯åŠ¨é€Ÿåº¦çš„æå‡æ²¡æœ‰é¢„åŠ è½½å¼•æ“æå‡çš„é‚£ä¹ˆå¤šã€‚

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/a8dae19b00cc4fcda79bf03b769cb47c~tplv-k3u1fbpfcp-watermark.image)

**æ— è®ºæ˜¯å¼•æ“é¢„åŠ è½½è¿˜æ˜¯ Dart VM é¢„çƒ­éƒ½æ˜¯æœ‰ä¸€å®šçš„å†…å­˜æˆæœ¬çš„ï¼Œå¦‚æœ App å†…å­˜å‹åŠ›ä¸å¤§ï¼Œå¹¶ä¸”é¢„åˆ¤ç”¨æˆ·æ¥ä¸‹æ¥ä¼šè®¿é—® Flutter ä¸šåŠ¡ï¼Œé‚£ä¹ˆä½¿ç”¨è¿™ä¸ªä¼˜åŒ–å°±èƒ½å¸¦æ¥å¾ˆå¥½çš„ä»·å€¼ï¼›åä¹‹ï¼Œåˆ™å¯èƒ½é€ æˆèµ„æºæµªè´¹ï¼Œæ„ä¹‰ä¸å¤§ã€‚**



# äº”ã€å†…å­˜ä¼˜åŒ–

## 1ã€const å®ä¾‹åŒ–

### ä¼˜åŠ¿

**const å¯¹è±¡åªä¼šåˆ›å»ºä¸€ä¸ªç¼–è¯‘æ—¶çš„å¸¸é‡å€¼ã€‚åœ¨ä»£ç è¢«åŠ è½½è¿› Dart Vm æ—¶ï¼Œåœ¨ç¼–è¯‘æ—¶ä¼šå­˜å‚¨åœ¨ä¸€ä¸ªç‰¹æ®Šçš„æŸ¥è¯¢è¡¨é‡Œï¼Œç”±äº flutter é‡‡ç”¨äº† AoT ç¼–è¯‘ï¼Œconst + values çš„æ–¹å¼ä¼šæä¾›ä¸€äº›å°çš„æ€§èƒ½ä¼˜åŠ¿ã€‚**ä¾‹å¦‚ï¼šconst Color() ä»…ä»…åªåˆ†é…ä¸€æ¬¡å†…å­˜ç»™å½“å‰å®ä¾‹ã€‚

### åº”ç”¨åœºæ™¯

Color()ã€GlobayKey() ç­‰ç­‰ã€‚

## 2ã€è¯†åˆ«å‡ºæ¶ˆè€—å¤šä½™å†…å­˜çš„å›¾ç‰‡

Flutter Inspectorï¼š**ç‚¹å‡» â€œInvert Oversized Imagesâ€ï¼Œå®ƒä¼šè¯†åˆ«å‡ºé‚£äº›è§£ç å¤§å°è¶…è¿‡å±•ç¤ºå¤§å°çš„å›¾ç‰‡ï¼Œå¹¶ä¸”ç³»ç»Ÿä¼šå°†å…¶å€’ç½®ï¼Œè¿™äº›ä½ å°±èƒ½æ›´å®¹æ˜“åœ¨ App é¡µé¢ä¸­æ‰¾åˆ°å®ƒã€‚**

![img](https://p3-juejin.byteimg.com/tos-cn-i-k3u1fbpfcp/5f40b02b91214afeafe39ff2ac183c15~tplv-k3u1fbpfcp-watermark.image)

é’ˆå¯¹è¿™äº›å›¾ç‰‡ï¼Œä½ å¯ä»¥æŒ‡å®š cacheWidth å’Œ cacheHeight ä¸ºå±•ç¤ºå¤§å°ï¼Œè¿™æ ·å¯ä»¥è®© flutter å¼•æ“ä»¥æŒ‡å®šå¤§å°è§£æå›¾ç‰‡ï¼Œå‡å°‘å†…å­˜æ¶ˆè€—ã€‚

## 3ã€é’ˆå¯¹ ListView item ä¸­æœ‰ image çš„æƒ…å†µæ¥ä¼˜åŒ–å†…å­˜

ListView ä¸èƒ½å¤Ÿæ€æ­»é‚£äº›åœ¨å±å¹•å¯è§†èŒƒå›´ä¹‹å¤–çš„é‚£äº› itemï¼Œå¦‚æœ item ä½¿ç”¨äº†é«˜åˆ†è¾¨ç‡çš„å›¾ç‰‡ï¼Œé‚£ä¹ˆå®ƒå°†ä¼šæ¶ˆè€—éå¸¸å¤šçš„å†…å­˜ã€‚

æ¢è¨€ä¹‹ï¼ŒListView åœ¨é»˜è®¤æƒ…å†µä¸‹ä¼šåœ¨æ•´ä¸ªæ»‘åŠ¨/ä¸æ»‘åŠ¨çš„è¿‡ç¨‹ä¸­è®©å­ Widget ä¿æŒæ´»åŠ¨çŠ¶æ€ï¼Œè¿™ä¸€ç‚¹æ˜¯é€šè¿‡ AutomaticKeepAlive æ¥ä¿è¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå­ Widget éƒ½ä¼šè¢«è¿™ä¸ª Widget åŒ…è£¹ï¼Œä»¥ä½¿è¢«åŒ…è£¹çš„å­ Widget ä¿æŒæ´»è·ƒã€‚

å…¶æ¬¡ï¼Œå¦‚æœç”¨æˆ·å‘åæ»šåŠ¨ï¼Œåˆ™ä¸ä¼šå†æ¬¡é‡æ–°ç»˜åˆ¶å­ Widgetï¼Œè¿™ä¸€ç‚¹æ˜¯é€šè¿‡ RepaintBoundaries æ¥ä¿è¯ï¼Œåœ¨é»˜è®¤æƒ…å†µä¸‹ï¼Œæ¯ä¸ªå­ Widget éƒ½ä¼šè¢«è¿™ä¸ª Widget åŒ…è£¹ï¼Œå®ƒä¼šè®©è¢«åŒ…è£¹çš„å­ Widget ä»…ä»…ç»˜åˆ¶ä¸€æ¬¡ï¼Œä»¥æ­¤è·å¾—æ›´é«˜çš„æ€§èƒ½ã€‚

ä½†ï¼Œè¿™æ ·çš„é—®é¢˜åœ¨äºï¼Œå¦‚æœåŠ è½½å¤§é‡çš„å›¾ç‰‡ï¼Œåˆ™ä¼šæ¶ˆè€—å¤§é‡çš„å†…å­˜ï¼Œæœ€ç»ˆå¯èƒ½ä½¿ App å´©æºƒã€‚

### è§£å†³æ–¹æ¡ˆ

**é€šè¿‡å°†è¿™ä¸¤ä¸ªé€‰é¡¹ç½®ä¸º false æ¥ç¦ç”¨å®ƒä»¬ï¼Œè¿™æ ·ä¸å¯è§çš„å­å…ƒç´ å°±ä¼šè¢«è‡ªåŠ¨å¤„ç†å’Œ GCã€‚**

```
ListView.builder(
  ...
  addAutomaticKeepAlives: false (true by default)
  addRepaintBoundaries: false (true by default)
);
å¤åˆ¶ä»£ç 
```

**ç”±äºé‡æ–°ç»˜åˆ¶å­å…ƒç´ å’Œç®¡ç†çŠ¶æ€ç­‰æ“ä½œä¼šå ç”¨æ›´å¤šçš„ CPU å’Œ GPU èµ„æºï¼Œä½†æ˜¯å®ƒèƒ½å¤Ÿè§£å†³ä½  App çš„å†…å­˜é—®é¢˜ï¼Œå¹¶ä¸”ä¼šå¾—åˆ°ä¸€ä¸ªé«˜æ€§èƒ½çš„è§†å›¾åˆ—è¡¨ã€‚**



# å…­ã€åŒ…ä½“ç§¯ä¼˜åŒ–

## 1ã€å›¾ç‰‡ä¼˜åŒ–

å¯¹å›¾ç‰‡å‹ç¼©æˆ–ä½¿ç”¨åœ¨çº¿çš„ç½‘ç»œå›¾ç‰‡ã€‚

## 2ã€ç§»é™¤å†—ä½™çš„åº“

éšç€ä¸šåŠ¡çš„å¢åŠ ï¼Œé¡¹ç›®ä¸­ä¼šå¼•å…¥è¶Šæ¥è¶Šå¤šçš„äºŒä¸‰æ–¹åº“ï¼Œå…¶ä¸­æœ‰ä¸å°‘æ˜¯åŠŸèƒ½é‡å¤çš„ï¼Œç”šè‡³æ˜¯å·²ç»ä¸å†ä½¿ç”¨çš„ã€‚ç§»é™¤ä¸å†ä½¿ç”¨çš„å’Œå°†ç›¸åŒåŠŸèƒ½çš„åº“è¿›è¡Œåˆå¹¶å¯ä»¥è¿›ä¸€æ­¥å‡å°‘åŒ…ä½“ç§¯ã€‚

## 3ã€å¯ç”¨ä»£ç ç¼©å‡å’Œèµ„æºç¼©å‡

æ‰“å¼€ minifyEnabled å’Œ shrinkResourcesï¼Œæ„å»ºå‡ºæ¥çš„ release åŒ…ä¼šå‡å°‘ 10% å·¦å³çš„å¤§å°ï¼Œç”šè‡³æ›´å¤šã€‚

## 4ã€æ„å»ºå• ABI æ¶æ„çš„åŒ…

ç›®å‰æ‰‹æœºå¸‚åœºä¸Šï¼Œx86 / x86_64/armeabi/mips / mips6 çš„å æœ‰é‡å¾ˆå°‘ï¼Œarm64-v8a ä½œä¸ºæœ€æ–°ä¸€ä»£æ¶æ„ï¼Œæ˜¯ç›®å‰çš„ä¸»æµï¼Œè€Œ armeabi-v7a åªå­˜åœ¨å°‘éƒ¨åˆ†çš„è€æ—§æ‰‹æœºä¸­ã€‚

æ‰€ä»¥ï¼Œ**ä¸ºäº†è¿›ä¸€æ­¥ä¼˜åŒ–åŒ…å¤§å°ï¼Œä½ å¯ä»¥æ„å»ºå‡ºå•ä¸€æ¶æ„çš„å®‰è£…åŒ…ï¼Œåœ¨ Flutter ä¸­å¯ä»¥é€šè¿‡ä»¥ä¸‹æ–¹å¼æ¥æ„å»ºå‡ºå•ä¸€æ¶æ„çš„å®‰è£…åŒ…**ï¼š

```
cd <flutteråº”ç”¨çš„androidç›®å½•>
flutter build apk --split-per-abi
å¤åˆ¶ä»£ç 
```

å¦‚æœæƒ³è¿›ä¸€æ­¥å‹ç¼©åŒ…ä½“ç§¯å¯å°† so è¿›è¡ŒåŠ¨æ€ä¸‹å‘ï¼Œå°† so æ”¾åœ¨è¿œç«¯è¿›è¡ŒåŠ¨æ€åŠ è½½ï¼Œä¸ä»…èƒ½è¿›ä¸€æ­¥å‡å°‘åŒ…ä½“ç§¯ä¹Ÿå¯ä»¥å®ç°ä»£ç çš„çƒ­ä¿®å¤å’ŒåŠ¨æ€åŠ è½½ã€‚



# ä¸ƒã€æ€»ç»“

åœ¨æœ¬ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¸»è¦ä»ä»¥ä¸‹ å…­ä¸ªæ–¹é¢ è®²è§£äº† Flutter æ€§èƒ½ä¼˜åŒ–ç›¸å…³çš„çŸ¥è¯†ï¼š

1ï¼‰ã€**æ£€æµ‹æ‰‹æ®µ**ï¼šFlutter Inspectorã€æ€§èƒ½å›¾å±‚ã€Raster å’Œ UI çº¿ç¨‹é—®é¢˜çš„å®šä½ ä½¿ç”¨ checkerboardOffscreenLayers æ£€æŸ¥å¤šè§†å›¾å åŠ çš„è§†å›¾æ¸²æŸ“ ã€ä½¿ç”¨ checkerboardRasterCacheImages æ£€æŸ¥ç¼“å­˜çš„å›¾åƒã€‚ 2ï¼‰ã€**å…³é”®ä¼˜åŒ–æŒ‡æ ‡**ï¼šåŒ…æ‹¬é¡µé¢å¼‚å¸¸ç‡ã€é¡µé¢å¸§ç‡ã€é¡µé¢åŠ è½½æ—¶é•¿ã€‚ 3ï¼‰ã€**å¸ƒå±€åŠ è½½ä¼˜åŒ–**ï¼šåå¤§å¸¸è§„ä¼˜åŒ–ã€ä¼˜åŒ–å…‰æ …çº¿ç¨‹ã€ç”¨ key åŠ é€Ÿ Flutter çš„æ€§èƒ½ã€‚ 4ï¼‰ã€**å¯åŠ¨é€Ÿåº¦ä¼˜åŒ–**ï¼šå¼•æ“é¢„åŠ è½½å’Œ Dart VM é¢„çƒ­ã€‚ 5ï¼‰ã€**å†…å­˜ä¼˜åŒ–**ï¼šconst å®ä¾‹åŒ–ã€è¯†åˆ«å‡ºæ¶ˆè€—å¤šä½™å†…å­˜çš„å›¾ç‰‡ã€é’ˆå¯¹ ListView item ä¸­æœ‰ image çš„æƒ…å†µæ¥ä¼˜åŒ–å†…å­˜ã€‚ 6ï¼‰ã€**åŒ…ä½“ç§¯ä¼˜åŒ–**ï¼šå›¾ç‰‡ä¼˜åŒ–ã€ç§»é™¤å†—ä½™çš„äºŒä¸‰åº“ã€å¯ç”¨ä»£ç ç¼©å‡å’Œèµ„æºç¼©å‡ã€æ„å»ºå• ABI æ¶æ„çš„åŒ…ã€‚

åœ¨è¿‘ä¸€å¹´å®è·µ Flutter çš„è¿‡ç¨‹ä¸­ï¼Œè¶Šå‘å‘ç°ä¸€ä¸ªäººçœŸæ­£åº”è¯¥å…·å¤‡çš„æ ¸å¿ƒèƒ½åŠ›åº”è¯¥æ˜¯ä½ çš„æ€è€ƒèƒ½åŠ›ã€‚

æ€è€ƒèƒ½åŠ›ï¼ŒåŒ…æ‹¬ **ç»“æ„åŒ–æ€è€ƒ/ç³»ç»Ÿæ€§æ€è€ƒ/è¿ç§»æ€è€ƒ/å±‚çº§æ€è€ƒ/é€†å‘æ€è€ƒ/å¤šå…ƒæ€è€ƒ** ç­‰ï¼Œä½¿ç”¨è¿™äº›æ€è€ƒèƒ½åŠ›åˆ†æé—®é¢˜æ—¶èƒ½å¿«é€Ÿåœ°æŠŠæ¡ä½é—®é¢˜çš„æœ¬è´¨ï¼Œåœ¨æœ¬è´¨ä¸ŠåšåŠŸå¤«ï¼Œæ‰æ˜¯ç‹é“ï¼Œæ‰æ˜¯çœŸçš„ yydsã€‚

### å‚è€ƒé“¾æ¥

- 1ã€[Flutterå®˜æ–¹æ–‡æ¡£-æ€§èƒ½ä¼˜åŒ–](https://link.juejin.cn/?target=https%3A%2F%2Fmedium.com%2Fflutter%2Fraster-thread-performance-optimization-tips-e949b9dbcf06)
- 2ã€[Flutter youtube é¢‘é“](https://link.juejin.cn/?target=https%3A%2F%2Fwww.youtube.com%2Fc%2Fflutterdev%2Ffeatured)
- 3ã€[Raster thread performance optimization tips](https://link.juejin.cn/?target=https%3A%2F%2Fmedium.com%2Fflutter%2Fraster-thread-performance-optimization-tips-e949b9dbcf06)
- 4ã€[Flutter Performance Tips](https://link.juejin.cn/?target=https%3A%2F%2Fitnext.io%2Fflutter-performance-tips-4580b2491da8)
- 5ã€[Flutter Performance Optimization](https://link.juejin.cn/?target=https%3A%2F%2Fmedium.flutterdevs.com%2Fflutter-performance-optimization-17c99bb31553)
- 6ã€[Elements, Keys and Flutterâ€™s performance](https://link.juejin.cn/?target=https%3A%2F%2Fmedium.com%2Fflutter-community%2Felements-keys-and-flutters-performance-3ef15c90f607)
- 7ã€[å¦‚ä½•æ£€æµ‹å¹¶ä¼˜åŒ–Flutter Appçš„æ•´ä½“æ€§èƒ½è¡¨ç°ï¼Ÿ](https://link.juejin.cn/?target=https%3A%2F%2Ftime.geekbang.org%2Fcolumn%2Farticle%2F138877)
- 8ã€[å¦‚ä½•åœ¨å‘½ä»¤å¼æ¡†æ¶ä¸­ä¿®æ”¹ UI](https://link.juejin.cn/?target=https%3A%2F%2Fflutter.cn%2Fdocs%2Fget-started%2Fflutter-for%2Fdeclarative)
- 9ã€[Flutter Layout Cheat Sheet](https://link.juejin.cn/?target=https%3A%2F%2Fmedium.com%2Fflutter-community%2Fflutter-layout-cheat-sheet-5363348d037e)
- 10ã€[Flutter: The Advanced Layout Rule Even Beginners Must Know](https://link.juejin.cn/?target=https%3A%2F%2Fmedium.com%2Fflutter-community%2Fflutter-the-advanced-layout-rule-even-beginners-must-know-edc9516d1a2)
- 11ã€[Profiling Flutter Applications Using the Timeline](https://link.juejin.cn/?target=https%3A%2F%2Fmedium.com%2Fflutter%2Fprofiling-flutter-applications-using-the-timeline-a1a434964af3)
- 12ã€[è¯´è¯´Flutterä¸­çš„RepaintBoundary](https://link.juejin.cn/?target=https%3A%2F%2Fweilu.blog.csdn.net%2Farticle%2Fdetails%2F103452637)
- 13ã€[è¯´è¯´Flutterä¸­æœ€ç†Ÿæ‚‰çš„é™Œç”Ÿäºº â€”â€” Key](https://link.juejin.cn/?target=https%3A%2F%2Fweilu.blog.csdn.net%2Farticle%2Fdetails%2F104745624)
- 14ã€[Splitting widgets to methods is an antipattern](https://link.juejin.cn/?target=https%3A%2F%2Fiiro.dev%2Fsplitting-widgets-to-methods-performance-antipattern%2F)
- 15ã€[What is the difference between functions and classes to create reusable widgets?](https://link.juejin.cn/?target=https%3A%2F%2Fstackoverflow.com%2Fquestions%2F53234825%2Fwhat-is-the-difference-between-functions-and-classes-to-create-reusable-widgets)
- 16ã€[How to improve the performance of your Flutter app](https://link.juejin.cn/?target=https%3A%2F%2Fblog.codemagic.io%2Fhow-to-improve-the-performance-of-your-flutter-app.%2F%23dont-split-your-widgets-into-methods)
- 17ã€[nil: ^1.1.1](https://link.juejin.cn/?target=https%3A%2F%2Fpub.dev%2Fpackages%2Fnil)
- 18ã€[How to improve the performance of your Flutter app](https://link.juejin.cn/?target=https%3A%2F%2Fblog.codemagic.io%2Fhow-to-improve-the-performance-of-your-flutter-app.%2F%23use-itemextent-in-listview-for-long-lists)
- 19ã€[Flutter memory optimization series](https://link.juejin.cn/?target=https%3A%2F%2Fdevmuaz.medium.com%2Fflutter-memory-optimization-series-8c4a73f3ea81)