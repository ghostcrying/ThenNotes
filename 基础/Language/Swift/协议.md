# Protocol



#### Codable

```
public typealias Codable = Decodable & Encodable

public protocol Encodable {
    func encode(to encoder: Encoder) throws
}
public protocol Decodable {
    init(from decoder: Decoder) throws
}
```

##### åº”ç”¨

```
let jsonStr = """
{
"age": 18,
"firstName": "Leon"
}
"""
/// å»ºç«‹æ¨¡å‹
struct Person: Codable {
  var age: Int
  var firstName: String
}

/// JSON è½¬æ¢ä¸ºModel
let decoder = JSONDecoder()
// æ•°ç»„æ¨¡å‹è½¬åŒ–  (æ³¨æ„ï¼šå…ˆå°†jsonå­—ç¬¦ä¸²è½¬ä¸ºdata)
let p = try decoder.decode(Person.self, from: json.data(using:.utf8)!)
```

##### å†²çª

ä½†æœ‰æ—¶åå°ç³»ç»Ÿä½¿ç”¨çš„å‘½åè§„åˆ™æœ‰å¯èƒ½ä¸å‰ç«¯ä¸ä¸€è‡´ï¼Œæ¯”å¦‚åå°å­—æ®µè¿”å›ä¸‹åˆ’çº¿å‘½åæ³•ï¼Œè€Œä¸€èˆ¬æˆ‘ä»¬ä½¿ç”¨é©¼å³°å‘½åæ³•ï¼Œæ‰€ä»¥åœ¨å­—æ®µæ˜ å°„çš„æ—¶å€™å°±éœ€è¦ä¿®æ”¹ä¸€ä¸‹ï¼Œä¾‹å¦‚åå°è¿”å›first_nameè€Œä¸æ˜¯firstName

###### æ–¹å¼ä¸€: å®ç°`CodingKey`åè®® è¿›è¡Œæšä¸¾æ˜ å°„

```
struct Person : Codable {
    var age: Int
    var firstName: String
    
    private enum CodingKeys : String, CodingKey {
        case age
        case firstName = "first_name"
    }
}
/// åªéœ€å¢åŠ ä¸€è¡Œä»£ç 
let decoder = JSONDecoder()
let p = try? decoder.decode(Person.self, from: jsonStr.data(using: .utf8)!)
```

###### æ–¹å¼äºŒ:

Swift4.1åæ˜¯åœ¨ç¼–ç çš„æ—¶å€™ï¼ŒæŠŠ `JSONEncoder` çš„å±æ€§ `keyEncodingStrategy` è®¾ç½®ä¸º `.convertToSnakeCase`ï¼›åœ¨è§£ç çš„æ—¶å€™ï¼ŒæŠŠ `JSONDecoder` çš„å±æ€§ `keyDecodingStrategy` è®¾ç½®æˆ `.convertFromSnakeCase`

```
public enum KeyDecodingStrategy {
    case useDefaultKeys
    case convertFromSnakeCase
    case custom(([CodingKey]) -> CodingKey) // è‡ªå®šä¹‰è½¬åŒ–è§„åˆ™
}
// ç¼–ç 
let leon = Person(age: 18, firstName: "Leon")
let encoder = JSONEncoder()
encoder.keyEncodingStrategy = .convertToSnakeCase
let resultData = try? encoder.encode(leon)

// è§£ç 
let data = jsonStr.data(using: .utf8)!
let decoder = JSONDecoder()
decoder.keyDecodingStrategy = .convertFromSnakeCase
if let person = try? decoder.decode(Person.self, from: data) {
    print("Age: \(person.age)  FirstName:\(person.firstName)")
}

```



#### CaseIterable

åœ¨æ—¥å¸¸çš„å¼€å‘ä¸­ï¼Œæˆ‘ä»¬ç»å¸¸éœ€è¦éå†ä¸€ä¸ªenumç±»å‹çš„æ‰€æœ‰caseï¼Œåœ¨Swift 4.2 ä¹‹åå¼•å…¥äº†åŸç”Ÿçš„caseéå†æ”¯æŒï¼Œä¹Ÿå°±æ˜¯è¯´ï¼Œç¼–è¯‘å™¨å¯ä»¥è‡ªåŠ¨ä¸ºæˆ‘ä»¬ç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰caseçš„é›†åˆ

```
enum Weekday: String, CaseIterable {
    case monday, tuesday, wednesday, thursday, friday
}
Weekday.allCases // ğŸ‘ŒğŸ»
enum Weekday1: String {
    case monday, tuesday, wednesday, thursday, friday
}
// type 'Weekday1' has no member 'allCases'
// Weekday1.allCases
```

å½“ç„¶ï¼ŒCaseIterableçš„ä½¿ç”¨ä¹Ÿæ˜¯æœ‰é™åˆ¶çš„ï¼Œä¾‹å¦‚ï¼šç¼–è¯‘å™¨ä¸ä¼šä¸ºå¸¦æœ‰associated valueçš„enumåˆæˆallCaseså±æ€§ã€‚åŸå› å¾ˆç®€å•ï¼Œå› ä¸ºç†è®ºä¸Šè¯´ï¼Œå¸¦æœ‰associated valueçš„enumæ˜¯æ‹¥æœ‰æ— ç©·å¤šä¸ªcaseçš„ï¼Œéå†æ‰€æœ‰çš„caseå½“ç„¶å°±æ— ä»è°ˆèµ·äº†.

```
enum Shape: CaseIterable {
    case rectangle
    // âš ï¸æŠ¥é”™ type 'Shape' does not conform to protocol 'CaseIterable'
    case circle(Double)
}
// âš ï¸type 'Shape' has no member 'allCases'
// Shape.allCases 
```



#### Equatable

ç¼–è¯‘å™¨åˆæˆ (synthesize) æ˜¯ååˆ†é‡è¦çš„åŠŸèƒ½ï¼Œå®ƒæŠŠå¼€å‘è€…ä»ç®€å•é‡å¤çš„åŠ³åŠ¨ä¸­è§£æ”¾å‡ºæ¥ã€‚åœ¨Swift 4.0 ä¸­ï¼Œæˆ‘ä»¬çŸ¥é“ Codable å¯ä»¥åˆæˆç›¸å…³å‡½æ•°ï¼Œäºæ˜¯ Codable çš„å®ç°è€…åœ¨å¤§éƒ¨åˆ†æƒ…å†µä¸‹ä¸éœ€è¦å®ç°ç›¸å…³å‡½æ•°ã€‚ åˆ°äº† Swift 4.1ï¼ŒEquatable å’Œ Hashable ä¹Ÿæ”¯æŒäº†åˆæˆã€‚è§¦å‘åˆæˆçš„ä¸€ä¸ªé‡è¦çš„å¿…è¦éå……åˆ†æ¡ä»¶æ˜¯ï¼šåŒ…å«çš„å­˜å‚¨å±æ€§æˆ–ç›¸å…³å€¼å…¨éƒ½æ˜¯ Codable / Equatable / Hashableï¼Œç¼–è¯‘å™¨æ‰æœ‰å¯èƒ½æ¨å¯¼å‡ºè¿™ä¸ªç±»å‹çš„ç›¸å…³å‡½æ•°å®ç°ã€‚

> ç›¸å…³æ¦‚å¿µ:
>
> - å¦‚æœå¯¹è±¡ç›¸ç­‰ï¼Œåˆ™è¿™ä¸¤ä¸ªå¯¹è±¡çš„ hash å€¼ä¸€å®šç›¸ç­‰ã€‚
> - å¦‚æœä¸¤ä¸ªå¯¹è±¡ hash å€¼ç›¸ç­‰ï¼Œè¿™ä¸¤ä¸ªå¯¹è±¡ä¸ä¸€å®šç›¸ç­‰ã€‚
> - Swift ä¸­ Hashable ä¸€å®šæ˜¯ Equatableï¼Œå› ä¸ºå‰è€…ç»§æ‰¿äº†åè€…
> - ä¿®æ”¹ == å‡½æ•°çš„æ—¶å€™éœ€è¦è€ƒè™‘æ˜¯å¦åŒæ­¥ä¿®æ”¹ hashValueï¼Œåä¹‹äº¦ç„¶ã€‚
> - Dictionary å’Œ Set çš„ä¸­çš„ Key ç±»å‹éƒ½è¦æ±‚æ˜¯ Hashable

```
let p1 = Person(age: 1, firstName: "")
let p2 = Person(age: 1, firstName: "")
if p1 == p2 { // æŠ¥é”™Binary operator '==' cannot be applied to two 'Person' operands
    print("Equal")
}
// ç»§æ‰¿Equatableå³å¯
struct Person: Equatable {
   ...
}
```

