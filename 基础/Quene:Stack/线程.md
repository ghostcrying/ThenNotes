# å¤šçº¿ç¨‹



#### è¿›ç¨‹

- è¿›ç¨‹æ˜¯ä¸€ä¸ªå…·æœ‰ä¸€å®šç‹¬ç«‹åŠŸèƒ½çš„ç¨‹åºå…³äºæŸæ¬¡æ•°æ®é›†åˆçš„ä¸€æ¬¡è¿è¡Œæ´»åŠ¨ï¼Œå®ƒæ˜¯æ“ä½œç³»ç»Ÿåˆ†é…èµ„æºçš„åŸºæœ¬å•å…ƒ.

- è¿›ç¨‹æ˜¯æŒ‡åœ¨ç³»ç»Ÿä¸­æ­£åœ¨è¿è¡Œçš„ä¸€ä¸ªåº”ç”¨ç¨‹åºï¼Œå°±æ˜¯ä¸€æ®µç¨‹åºçš„æ‰§è¡Œè¿‡ç¨‹,æˆ‘ä»¬å¯ä»¥ç†è§£ä¸ºæ‰‹æœºä¸Šçš„ä¸€ä¸ªapp.

- æ¯ä¸ªè¿›ç¨‹ä¹‹é—´æ˜¯ç‹¬ç«‹çš„ï¼Œæ¯ä¸ªè¿›ç¨‹å‡è¿è¡Œåœ¨å…¶ä¸“ç”¨ä¸”å—ä¿æŠ¤çš„å†…å­˜ç©ºé—´å†…ï¼Œæ‹¥æœ‰ç‹¬ç«‹è¿è¡Œæ‰€éœ€çš„å…¨éƒ¨èµ„æº

#### çº¿ç¨‹

- ç¨‹åºæ‰§è¡Œæµçš„æœ€å°å•å…ƒï¼Œçº¿ç¨‹æ˜¯è¿›ç¨‹ä¸­çš„ä¸€ä¸ªå®ä½“.
- ä¸€ä¸ªè¿›ç¨‹è¦æƒ³æ‰§è¡Œä»»åŠ¡,å¿…é¡»è‡³å°‘æœ‰ä¸€æ¡çº¿ç¨‹.åº”ç”¨ç¨‹åºå¯åŠ¨çš„æ—¶å€™ï¼Œç³»ç»Ÿä¼šé»˜è®¤å¼€å¯ä¸€æ¡çº¿ç¨‹,ä¹Ÿå°±æ˜¯ä¸»çº¿ç¨‹

#### è¿›ç¨‹å’Œçº¿ç¨‹çš„å…³ç³»

- çº¿ç¨‹æ˜¯è¿›ç¨‹çš„æ‰§è¡Œå•å…ƒï¼Œè¿›ç¨‹çš„æ‰€æœ‰ä»»åŠ¡éƒ½åœ¨çº¿ç¨‹ä¸­æ‰§è¡Œ

- çº¿ç¨‹æ˜¯ CPU åˆ†é…èµ„æºå’Œè°ƒåº¦çš„æœ€å°å•ä½

- ä¸€ä¸ªç¨‹åºå¯ä»¥å¯¹åº”å¤šä¸ªè¿›ç¨‹(å¤šè¿›ç¨‹),ä¸€ä¸ªè¿›ç¨‹ä¸­å¯æœ‰å¤šä¸ªçº¿ç¨‹,ä½†è‡³å°‘è¦æœ‰ä¸€æ¡çº¿ç¨‹

- åŒä¸€ä¸ªè¿›ç¨‹å†…çš„çº¿ç¨‹å…±äº«è¿›ç¨‹èµ„æº

#### å¤šçº¿ç¨‹

- åŒä¸€æ—¶é—´ï¼ŒCPUåªèƒ½å¤„ç†1æ¡çº¿ç¨‹ï¼Œåªæœ‰1æ¡çº¿ç¨‹åœ¨æ‰§è¡Œã€‚å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œï¼Œå…¶å®æ˜¯CPUå¿«é€Ÿåœ°åœ¨å¤šæ¡çº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼ˆåˆ‡æ¢ï¼‰ã€‚å¦‚æœCPUè°ƒåº¦çº¿ç¨‹çš„æ—¶é—´è¶³å¤Ÿå¿«ï¼Œå°±é€ æˆäº†å¤šçº¿ç¨‹å¹¶å‘æ‰§è¡Œçš„å‡è±¡

- å¦‚æœçº¿ç¨‹éå¸¸éå¸¸å¤šï¼ŒCPUä¼šåœ¨Nå¤šçº¿ç¨‹ä¹‹é—´è°ƒåº¦ï¼Œæ¶ˆè€—å¤§é‡çš„CPUèµ„æºï¼Œæ¯æ¡çº¿ç¨‹è¢«è°ƒåº¦æ‰§è¡Œçš„é¢‘æ¬¡ä¼šé™ä½ï¼ˆçº¿ç¨‹çš„æ‰§è¡Œæ•ˆç‡é™ä½ï¼‰

- ###### å¤šçº¿ç¨‹çš„ä¼˜ç‚¹:

  - èƒ½é€‚å½“æé«˜ç¨‹åºçš„æ‰§è¡Œæ•ˆç‡
  - èƒ½é€‚å½“æé«˜èµ„æºåˆ©ç”¨ç‡ï¼ˆCPUã€å†…å­˜åˆ©ç”¨ç‡ï¼‰

- ###### å¤šçº¿ç¨‹çš„ç¼ºç‚¹:

  - å¼€å¯çº¿ç¨‹éœ€è¦å ç”¨ä¸€å®šçš„å†…å­˜ç©ºé—´ï¼ˆé»˜è®¤æƒ…å†µä¸‹ï¼Œä¸»çº¿ç¨‹å ç”¨1Mï¼Œå­çº¿ç¨‹å ç”¨512KBï¼‰ï¼Œå¦‚æœå¤§é‡å¼€å¯å¼€å¯çº¿ç¨‹ï¼ŒCPUåœ¨è°ƒåº¦çº¿ç¨‹ä¸Šçš„å¼€é”€å°±è¶Šå¤§
  - ç¨‹åºè®¾è®¡æ›´åŠ å¤æ‚ï¼šæ¯”å¦‚çº¿ç¨‹ä¹‹é—´çš„é€šä¿¡ã€å¤šçº¿ç¨‹çš„æ•°æ®å…±äº«
  
- å¤šçº¿ç¨‹BUG

  - å¤šçº¿ç¨‹å®¹æ˜“å¯¼è‡´èµ„æºäº‰æŠ¢,å‘ç”Ÿæ­»é”ç°è±¡, è§£å†³æ–¹å¼ : æ …æ  ä¾èµ– ç­‰æ–¹å¼

    ```
    (ä¾‹å¦‚: ä¸€ä¸ªçº¿ç¨‹é”å®šäº†èµ„æºA,åˆè¦å»é”å®šèµ„æºB ,å¦ä¸€ä¸ªçº¿ç¨‹é”å®šäº†èµ„æºB,åˆè¦å»é”å®šèµ„æºA,éƒ½æƒ³è¦å¾—åˆ°å¯¹æ–¹çš„èµ„æº,è€Œä¸æ„¿é‡Šæ”¾è‡ªèº«èµ„æº,è¿›å…¥ç›¸äº’ç­‰å¾…è¿‡ç¨‹ä¸­,è€Œæ— æ³•æ‰§è¡Œçš„æƒ…å†µ )
    ```

#### ä»»åŠ¡

- ###### åŒæ­¥(Sync)

  - åŒæ­¥æ·»åŠ ä»»åŠ¡åˆ°æŒ‡å®šçš„é˜Ÿåˆ—ä¸­ï¼Œåœ¨æ·»åŠ çš„ä»»åŠ¡æ‰§è¡Œç»“æŸä¹‹å‰ï¼Œä¼šä¸€ç›´ç­‰å¾…ï¼Œç›´åˆ°é˜Ÿåˆ—é‡Œé¢çš„ä»»åŠ¡å®Œæˆä¹‹åå†ç»§ç»­æ‰§è¡Œï¼Œå³ä¼šé˜»å¡çº¿ç¨‹ã€‚åªèƒ½åœ¨å½“å‰çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡(æ˜¯å½“å‰çº¿ç¨‹ï¼Œä¸ä¸€å®šæ˜¯ä¸»çº¿ç¨‹)ï¼Œä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ã€‚

- ###### å¼‚æ­¥(Async)

  - çº¿ç¨‹ä¼šç«‹å³è¿”å›ï¼Œæ— éœ€ç­‰å¾…å°±ä¼šç»§ç»­æ‰§è¡Œä¸‹é¢çš„ä»»åŠ¡ï¼Œä¸é˜»å¡å½“å‰çº¿ç¨‹ã€‚å¯ä»¥åœ¨æ–°çš„çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡ï¼Œå…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›(å¹¶ä¸ä¸€å®šå¼€å¯æ–°çº¿ç¨‹)ã€‚å¦‚æœä¸æ˜¯æ·»åŠ åˆ°ä¸»é˜Ÿåˆ—ä¸Šï¼Œå¼‚æ­¥ä¼šåœ¨å­çº¿ç¨‹ä¸­æ‰§è¡Œä»»åŠ¡

#### é˜Ÿåˆ—Quene

- ###### ä¸²è¡Œé˜Ÿåˆ— (Serial Dispatch Queue)

  - åŒä¸€æ—¶é—´å†…ï¼Œé˜Ÿåˆ—ä¸­åªèƒ½æ‰§è¡Œä¸€ä¸ªä»»åŠ¡ï¼Œåªæœ‰å½“å‰çš„ä»»åŠ¡æ‰§è¡Œå®Œæˆä¹‹åï¼Œæ‰èƒ½æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ã€‚ï¼ˆåªå¼€å¯ä¸€ä¸ªçº¿ç¨‹ï¼Œä¸€ä¸ªä»»åŠ¡æ‰§è¡Œå®Œæ¯•åï¼Œå†æ‰§è¡Œä¸‹ä¸€ä¸ªä»»åŠ¡ï¼‰ã€‚ä¸»é˜Ÿåˆ—æ˜¯ä¸»çº¿ç¨‹ä¸Šçš„ä¸€ä¸ªä¸²è¡Œé˜Ÿåˆ—,æ˜¯ç³»ç»Ÿè‡ªåŠ¨ä¸ºæˆ‘ä»¬åˆ›å»ºçš„

- ###### å¹¶è¡Œé˜Ÿåˆ—(Concurrent Dispatch Queue)

  - åŒæ—¶å…è®¸å¤šä¸ªä»»åŠ¡å¹¶å‘æ‰§è¡Œã€‚ï¼ˆå¯ä»¥å¼€å¯å¤šä¸ªçº¿ç¨‹ï¼Œå¹¶ä¸”åŒæ—¶æ‰§è¡Œä»»åŠ¡ï¼‰ã€‚å¹¶å‘é˜Ÿåˆ—çš„å¹¶å‘åŠŸèƒ½åªæœ‰åœ¨å¼‚æ­¥ï¼ˆdispatch_asyncï¼‰å‡½æ•°ä¸‹æ‰æœ‰æ•ˆ

![img](https://upload-images.jianshu.io/upload_images/1782258-f8b19e132a6181be.png?imageMogr2/auto-orient/strip|imageView2/2/w/1200)

![img](https://upload-images.jianshu.io/upload_images/1214547-7490d67912ed239e.png?imageMogr2/auto-orient/strip|imageView2/2/w/785)

> - ä¸Šå›¾ä¸­ä»»åŠ¡1,2,3 å°±æ˜¯é—­åŒ…block
> - é˜Ÿåˆ—å°±æ˜¯æˆ‘ä»¬æŒ‡å®šæ‰§è¡Œä»»åŠ¡çš„Quene
>
> blocké—­åŒ…å°±æ˜¯æˆ‘ä»¬æƒ³åšçš„ä»»åŠ¡(Task)ï¼Œäº¤ç»™GCDå‡½æ•°ã€‚GCDå‡½æ•°ä¼šæŠŠä»»åŠ¡æ”¾è¿›æˆ‘ä»¬æŒ‡å®šçš„é˜Ÿåˆ—ï¼ˆQueueï¼‰ï¼Œå½“ç„¶GCDå‡½æ•°å†…éƒ¨ä¸æ­¢æ˜¯æŠŠä»»åŠ¡æ”¾è¿›é˜Ÿåˆ—ï¼Œè¿˜åŒ…æ‹¬ä¸€äº›å…¶ä»–ä¸ä¸ºæˆ‘ä»¬æ‰€çŸ¥çš„æ“ä½œã€‚é˜Ÿåˆ—éµå¾ªä¸¥æ ¼çš„å…ˆè¿›å…ˆå‡ºåŸåˆ™ï¼ŒåŒä¸€ä¸ªQueueä¸­ï¼Œæœ€æ—©å…¥åˆ—çš„blockï¼Œä¼šæœ€æ—©è¢«åˆ†é…ç»™çº¿ç¨‹æ‰§è¡Œã€‚ç³»ç»Ÿï¼ˆâ€œç³»ç»Ÿâ€æŒ‡æ‰€æœ‰è¢«è‹¹æœé»‘ç›’å°è£…ï¼Œæœªå…¬å¼€æºç ï¼Œæˆ‘ä»¬ä¸èƒ½å¾—çŸ¥çš„æ“ä½œï¼Œä¸‹åŒï¼‰ä¼šä¾æ®é¡ºåºä»é˜Ÿåˆ—ä¸­å–å‡ºblockï¼Œå¹¶ä¸”äº¤ç”±çº¿ç¨‹æ‰§è¡Œã€‚GCDé˜Ÿåˆ—åªæ˜¯ç»„ç»‡å¾…æ‰§è¡Œä»»åŠ¡çš„ä¸€ä¸ªæ•°æ®ç»“æ„å°è£…ï¼Œè€Œçº¿ç¨‹ï¼Œæ‰æ˜¯æ‰§è¡Œä»»åŠ¡çš„äºº.



#### å®ç°

##### NSThread

> è½»é‡çº§åˆ«çš„å¤šçº¿ç¨‹æŠ€æœ¯

- å¼€å¯

  ```
  print("1")
  let t = Thread.init {
      print("4")
  }
  t.start()
  print("3")
  // æ‰“å°: 1, 3, 4
  // æ‰§è¡Œç»“æŸåté”€æ¯
  ```

- å¸¸é©»

  ```
  var thread: Thread!
  print("1")
  thread = Thread(block: {
      print("3")
      RunLoop.current.add(Port(), forMode: .default)
      RunLoop.current.run()
      print("4")
  })
  thread.start()
  print("2")
  // æ‰“å°: 1, 2, 3
  ```

##### performSelector: onThread: withObject: waitUntilDone:

> æ·»åŠ åˆ°çº¿ç¨‹å, ä¼šåœ¨æŒ‡å®šçº¿ç¨‹æ‰§è¡Œ waitUntilDone: æ˜¯å¦ç­‰å¾…performSelectorTestæ‰§è¡Œå®Œæˆåæ‰ç»§ç»­æ‰§è¡Œ

- å¸¸é©»çº¿ç¨‹

  ```
  class MyThread {
      
      static let shared = MyThread()
      
      var longThread: Thread!
      
      init() {
          print("MyThread init")
          longThread = Thread(block: {
              print("long thead block start")
              // add current thread to runloop with a mode
              RunLoop.current.add(NSMachPort(), forMode: .default)
              // run it
              RunLoop.current.run()
              print("long thead block ended")
          })
          // set thread name
          longThread.name = "longThread"
          // start thread
          longThread.start()
      }
      
      deinit {
          print("MyThread release")
      }
  }
  perform(#selector(testThread), on: MyThread.shared.longThread, with: nil, waitUntilDone: true)
  @objc func testThread() { print("mythread touch") }
  ```



##### NSOprationQueue/GCD

> - GCDæ˜¯é¢å‘åº•å±‚çš„Cè¯­è¨€çš„APIï¼ŒNSOpertaionQueueç”¨GCDæ„å»ºå°è£…çš„ï¼Œæ˜¯GCDçš„é«˜çº§æŠ½è±¡
> - GCDæ‰§è¡Œæ•ˆç‡æ›´é«˜ï¼Œè€Œä¸”ç”±äºé˜Ÿåˆ—ä¸­æ‰§è¡Œçš„æ˜¯ç”±blockæ„æˆçš„ä»»åŠ¡ï¼Œè¿™æ˜¯ä¸€ä¸ªè½»é‡çº§çš„æ•°æ®ç»“æ„ï¼Œå†™èµ·æ¥æ›´æ–¹ä¾¿
> - GCDåªæ”¯æŒFIFOçš„é˜Ÿåˆ—ï¼Œè€ŒNSOperationQueueå¯ä»¥é€šè¿‡è®¾ç½®æœ€å¤§å¹¶å‘æ•°ï¼Œè®¾ç½®ä¼˜å…ˆçº§ï¼Œæ·»åŠ ä¾èµ–å…³ç³»ç­‰è°ƒæ•´æ‰§è¡Œé¡ºåº
> - NSOperationQueueç”šè‡³å¯ä»¥è·¨é˜Ÿåˆ—è®¾ç½®ä¾èµ–å…³ç³»ï¼Œä½†æ˜¯GCDåªèƒ½é€šè¿‡è®¾ç½®ä¸²è¡Œé˜Ÿåˆ—ï¼Œæˆ–è€…åœ¨é˜Ÿåˆ—å†…æ·»åŠ barrier(dispatch_barrier_async)ä»»åŠ¡ï¼Œæ‰èƒ½æ§åˆ¶æ‰§è¡Œé¡ºåº,è¾ƒä¸ºå¤æ‚
> - NSOperationQueueå› ä¸ºé¢å‘å¯¹è±¡ï¼Œæ‰€ä»¥æ”¯æŒKVOï¼Œå¯ä»¥ç›‘æµ‹operationæ˜¯å¦æ­£åœ¨æ‰§è¡Œï¼ˆisExecutedï¼‰ã€æ˜¯å¦ç»“æŸï¼ˆisFinishedï¼‰ã€æ˜¯å¦å–æ¶ˆï¼ˆisCanceldï¼‰

###### NSOperation

> æŠ½è±¡ç±»ï¼Œç”¨æ¥æ·»åŠ ä»»åŠ¡ (å­ç±»NSInvocationOperationå’ŒNSBlockOperation)
>
> - isReadyï¼šå½“å‰ä»»åŠ¡å‡†å¤‡å°±ç»ª
>
> - isExecutingï¼šå½“å‰ä»»åŠ¡æ­£åœ¨æ‰§è¡Œ
>
> - isFinishedï¼šå½“å‰ä»»åŠ¡å·²æ‰§è¡Œå®Œæ¯•
>
> - isCancelï¼šå½“å‰ä»»åŠ¡è¢«å–æ¶ˆ

```
let operation = BlockOperation {
    print("Start")
}
operation.addExecutionBlock {
    print("++")
}
operation.addExecutionBlock {
    for i in 0..<5 {
        print(i)
    }
}
operation.addExecutionBlock {
    print("--")
}
operation.start()
/// ä¹±åºæ‰“å°
```

###### NSOperationQuene

> - maxConcurrentOperationCounté»˜è®¤ä¸º-1ï¼Œç›´æ¥å¹¶å‘æ‰§è¡Œï¼Œæ‰€ä»¥åŠ å…¥åˆ°â€˜éé˜Ÿåˆ—â€™ä¸­çš„ä»»åŠ¡é»˜è®¤å°±æ˜¯å¹¶å‘ï¼Œå¼€å¯å¤šçº¿ç¨‹ã€‚
>
> - maxConcurrentOperationCount == 1: è¡¨ç¤ºä¸å¼€çº¿ç¨‹ï¼Œä¹Ÿå°±æ˜¯ä¸²è¡Œ
>
> - maxConcurrentOperationCount > 1: è¿›è¡Œå¹¶å‘æ‰§è¡Œã€‚
>
> - ç³»ç»Ÿå¯¹æœ€å¤§å¹¶å‘æ•°æœ‰ä¸€ä¸ªé™åˆ¶ï¼Œæ‰€ä»¥å³ä½¿ç¨‹åºå‘˜æŠŠmaxConcurrentOperationCountè®¾ç½®çš„å¾ˆå¤§ï¼Œç³»ç»Ÿä¹Ÿä¼šè‡ªåŠ¨è°ƒæ•´ã€‚æ‰€ä»¥æŠŠæœ€å¤§å¹¶å‘æ•°è®¾ç½®çš„å¾ˆå¤§æ˜¯æ²¡æœ‰æ„ä¹‰çš„

```
let operation = OperationQueue()
let op1 = BlockOperation {
    print("op1")
}
let op2 = BlockOperation {
    print("op2")
}
op2.addExecutionBlock {
    for i in 0..<5 {
        print(i)
    }
}
let op3 = BlockOperation {
    print("op3")
    OperationQueue.main.addOperation {
        print("Main")
    }
}
op1.addDependency(op2)
op2.addDependency(op3)

operation.addOperation(op1)
operation.addOperation(op2)
operation.addOperation(op3)
// å¯ä»¥è®¾å®šæœ€å¤§å¹¶å‘
// operation.maxConcurrentOperationCount = 2
// é»˜è®¤-1
/*
 op3
 op2
 0
 1
 2
 3
 4
 op1
 Main
 */
```

###### GCD

- group

  ```
  let quene = DispatchQueue(label: "--")
  let group = DispatchGroup()
  for i in 0..<5 {
      DispatchQueue.global().async(group: group, qos: .default) {
          print(i)
      }
  }
  group.notify(queue: quene) { /// queneå¯ä»¥æ”¹ä¸ºä¸»çº¿ç¨‹æ‰§è¡Œ
      print("E")
  }
  /// Eåœ¨ 0-10ä¹±åºæ‰“å°åæ‰“å°, ä½†æ˜¯0-10æ˜¯å¹¶å‘æ‰“å°, é¡ºåºä¸å®š
  ```

  ```
  let group = DispatchGroup()
  for i in 0..<10 {
      group.enter()
      DispatchQueue.global().async {
          Thread.sleep(forTimeInterval: TimeInterval(arc4random_uniform(2) +    1))
          print(i)
          group.leave()
      }
  }
  group.notify(queue: .main) { /// queneå¯ä»¥æ”¹ä¸ºä¸»çº¿ç¨‹æ‰§è¡Œ
      print("E")
  }
  /// æ— é™ç­‰å¾…, é˜»å¡, éœ€è¦åœ¨å­çº¿ç¨‹ä¸­
  _ = group.wait(timeout: DispatchTime.distantFuture)
  print("C")
  /// 1~10ä¹±åº, ä¹‹åC, E
  ```

- semple

  ```
  let quene = DispatchQueue.global(qos: .default)
  let semple = DispatchSemaphore(value: 1)
  for i in 0..<10 {
      semple.wait()
      quene.async {
          print(i)
          semple.signal()
      }
  }
  ```

- barrier

  ```
  // concurrent: åˆ—é˜Ÿæ˜¯å¹¶å‘çš„
  // .initiallyInactiveï¼šåˆ—é˜Ÿä¸ä¼šè‡ªåŠ¨æ‰§è¡Œï¼Œéœ€è¦å¼€å‘ä¸­æ‰‹åŠ¨è§¦å‘
  let quene = DispatchQueue(label: "foo", attributes: .concurrent)
  quene.async {
      for i in 0..<5 {
          DispatchQueue.global().async {
              print(i)
          }
      }
  }
  quene.async(group: nil, qos: .default, flags: .barrier) {
      print("Barrier cut: ğŸ¦")
  }
  quene.async {
      print("Barrier last: ğŸº")
  }
  /*
   0 1 2 3 4
   Barrier cut: ğŸ¦
   Barrier last: ğŸº
   */
  ```

- apply

  ```
  dispatch_queue_t queue = dispatch_get_global_queue(DISPATCH_QUEUE_PRIORITY_DEFAULT, 0);
  /*! dispatch_applyå‡½æ•°è¯´æ˜
   *
   *  @brief  dispatch_applyå‡½æ•°æ˜¯dispatch_syncå‡½æ•°å’ŒDispatch Groupçš„å…³è”API
   *         è¯¥å‡½æ•°æŒ‰æŒ‡å®šçš„æ¬¡æ•°å°†æŒ‡å®šçš„Blockè¿½åŠ åˆ°æŒ‡å®šçš„Dispatch Queueä¸­,å¹¶ç­‰åˆ°å…¨éƒ¨çš„å¤„ç†æ‰§è¡Œç»“æŸ
   *
   *  @param 10    æŒ‡å®šé‡å¤æ¬¡æ•°  æŒ‡å®š10æ¬¡
   *  @param queue è¿½åŠ å¯¹è±¡çš„Dispatch Queue
   *  @param index å¸¦æœ‰å‚æ•°çš„Block, indexçš„ä½œç”¨æ˜¯ä¸ºäº†æŒ‰æ‰§è¡Œçš„é¡ºåºåŒºåˆ†å„ä¸ªBlock
   */
  dispatch_apply(10, queue, ^(size_t index) {
      NSLog(@"%zu", index);
  });
  NSLog(@"done");
  
  /*!
   *  @brief  è¾“å‡ºç»“æœ
   *
   2016-02-25 19:24:39.102 dispatch_applyæµ‹è¯•[2985:165004] 0
   2016-02-25 19:24:39.102 dispatch_applyæµ‹è¯•[2985:165086] 1
   2016-02-25 19:24:39.104 dispatch_applyæµ‹è¯•[2985:165004] 4
   2016-02-25 19:24:39.104 dispatch_applyæµ‹è¯•[2985:165004] 5
   2016-02-25 19:24:39.104 dispatch_applyæµ‹è¯•[2985:165004] 6
   2016-02-25 19:24:39.103 dispatch_applyæµ‹è¯•[2985:165088] 3
   2016-02-25 19:24:39.104 dispatch_applyæµ‹è¯•[2985:165004] 7
   2016-02-25 19:24:39.105 dispatch_applyæµ‹è¯•[2985:165004] 8
   2016-02-25 19:24:39.105 dispatch_applyæµ‹è¯•[2985:165004] 9
   2016-02-25 19:24:39.102 dispatch_applyæµ‹è¯•[2985:165087] 2
   2016-02-25 19:24:39.105 dispatch_applyæµ‹è¯•[2985:165004] done
   *  !!!å› ä¸ºåœ¨Global Dispatch Queueä¸­æ‰§è¡Œ,æ‰€ä»¥å„ä¸ªå¤„ç†çš„æ‰§è¡Œæ—¶é—´ä¸å®š
   ä½†doneä¸€å®šä¼šè¾“å‡ºåœ¨æœ€åçš„ä½ç½®,å› ä¸ºdispatch_applyå‡½æ•°ä¼šç­‰å¾…æ‰€ä»¥çš„å¤„ç†ç»“æŸ
   */
  ```

  

###### GCDæ­»é” (é˜Ÿåˆ—é˜»å¡)

- å¸¸è§„

```
let quene = DispatchQueue(label: "quene", attributes: .concurrent) // å¹¶è¡Œ, é™¤å¼€é˜»å¡ä»»åŠ¡å¤–, å…¶ä»–ä»»åŠ¡å¹¶è¡Œ
// let quene = DispatchQueue(label: "quene") // é»˜è®¤ä¸²è¡Œ, åˆ™å•ä»»åŠ¡å‘ä¸‹æ‰§è¡Œ
print(quene)
quene.async {
    (0..<100).forEach {
        print("1-\($0)")
    }
}
quene.sync {
    print("2-1")
}
(0..<100).forEach {
    print("3-\($0)")
}

/// ä¸²è¡Œåˆ™é¡ºåºæ‰§è¡Œ1, 2, 3
/// å¹¶è¡Œ, åˆ™2é¡ºåºæ‰§è¡Œ(ä½†æ˜¯2å¯èƒ½åœ¨å¼€å§‹æ‰§è¡Œ, ä¹Ÿå¯èƒ½åœ¨ä¸­é—´æ‰§è¡Œ), 1-3äº¤å‰æ‰§è¡Œ, 
```

- é˜»å¡

```
let queue = DispatchQueue(label: "myQueue", attributes: .concurrent) // å¹¶è¡Œé˜Ÿåˆ—
queue.async {
    print("1")
    queue.sync {
        print("2")
    }
    print("3")
}
// 1, 2, 3

/// æ­»é”
let quene = DispatchQueue(label: "--") // é»˜è®¤ä¸²è¡Œé˜Ÿåˆ—
quene.async {
    print("1")
    quene.sync { // åŒæ­¥ä»»åŠ¡t
        print("2") // ä»»åŠ¡2åŠ åœ¨ä»»åŠ¡3ä¹‹å, 
    }
    print("3")  // åŠ å…¥é˜Ÿåˆ—, ç­‰å¾…2å®Œæˆ
}
// é˜Ÿåˆ—ä¸­: [1, t, 3]
// tä¸ºåŒæ­¥é˜Ÿåˆ—, å°†ä»»åŠ¡2åŠ å…¥åœ¨ä¸²è¡Œé˜Ÿåˆ—ä¸­[1, t, 3, 2]
// tä¼šé˜»å¡é˜Ÿåˆ—, ä»»åŠ¡3å¿…é¡»ç­‰å¾…ä»»åŠ¡2æ‰§è¡Œ, ä½†ä»»åŠ¡2åœ¨ä»»åŠ¡3ä¹‹å, æ­»å¾ªç¯.
```

- syncæ˜¯åŒæ­¥å‡½æ•°ä¸å…·å¤‡å¼€å¯æ–°çº¿ç¨‹èƒ½åŠ›, å…¶blockåªä¼šåœ¨å½“å‰çº¿ç¨‹æ‰§è¡Œ, ä¸è®ºä¼ å…¥çš„æ˜¯ä¸²è¡Œè¿˜æ˜¯å¹¶è¡Œ.

  - å®ƒä¼šä¸€å®šä¼šç­‰å¾…closureé—­åŒ…æ‰§è¡Œå®Œæ¯•æ‰è¿”å›.

- asyncæ˜¯å¼‚æ­¥å‡½æ•°ï¼Œå…·å¤‡å¼€å¯æ–°çº¿ç¨‹çš„èƒ½åŠ›ï¼Œä½†æ˜¯ä¸ä¸€å®šä¼šå¼€å¯æ–°çº¿ç¨‹ï¼Œäº¤ç»™å®ƒçš„`é—­åŒ…`å¯èƒ½åœ¨ä»»ä½•çº¿ç¨‹æ‰§è¡Œï¼Œå¼€å‘è€…æ— æ³•æ§åˆ¶ï¼Œæ˜¯GCDåº•å±‚åœ¨æ§åˆ¶ã€‚

  - å®ƒä¼šç«‹å³è¿”å›ï¼Œä¸ä¼šç­‰å¾…closureé—­åŒ…è¢«æ‰§è¡Œ

- **è§£å†³é˜»å¡æ–¹æ¡ˆ**

  1. **è¿›è¡Œasyncç›´æ¥è¿”å›, ä¸é˜»å¡é˜Ÿåˆ—å³å¯**
  2. **åˆ›å»ºæ–°é˜Ÿåˆ—, é¿å…ä¸å½“å‰é˜Ÿåˆ—å†²çªä¹Ÿå¯**.

- **sync/asyncçš„é—­åŒ…å—å†…éƒ¨ä»£ç æ˜¯é¡ºåºæ‰§è¡Œ**

  ```
  let quene = DispatchQueue(label: "--") // é»˜è®¤ä¸²è¡Œé˜Ÿåˆ—
  quene.async {
      /// ä¸²è¡Œé˜Ÿåˆ—, blockå†…éƒ¨ä»£ç é¡ºåºæ‰§è¡Œ
      print("1")
      quene.async { 
          // æœªå¼€è¾Ÿçº¿ç¨‹
          print("3") 
          print("4") 
      }
      print("2")  // åŠ å…¥é˜Ÿåˆ—, ç­‰å¾…2å®Œæˆ
  }
  // 1æ‰§è¡Œå®Œæ¯•, æ‰§è¡Œé—­åŒ…ç«‹å³è¿”å›, æ‰§è¡Œ2, ç»§ç»­æ‰§è¡Œé—­åŒ…ä»»åŠ¡3, 4
  
  let quene = DispatchQueue(label: "--", attributes: .concurrent)
  quene.async {
      /// å¹¶è¡Œé˜Ÿåˆ—, é‡åˆ°å¼‚æ­¥å¹¶è¡Œæ‰§è¡Œ
      print("1")
      quene.async { 
          // å¼€è¾Ÿäº†çº¿ç¨‹
          print("3") 
          print("4") 
          print("5")
      }
      print("2") 
  }
  // 1æ‰§è¡Œå®Œ, æ‰§è¡Œé—­åŒ…ç«‹å³è¿”å›, 2ä¸345æ˜¯å¹¶è¡Œ, é¡ºåºä¸å®š
  ```
  
  
